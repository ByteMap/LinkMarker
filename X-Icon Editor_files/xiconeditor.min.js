/*
 * jQuery UI 1.8.5
 *
 * Copyright 2010, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI
 */
(function(c,a){c.ui=c.ui||{};if(c.ui.version){return}c.extend(c.ui,{version:"1.8.5",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}});c.fn.extend({_focus:c.fn.focus,focus:function(e,d){return typeof e==="number"?this.each(function(){var f=this;setTimeout(function(){c(f).focus();if(d){d.call(f)}},e)}):this._focus.apply(this,arguments)},scrollParent:function(){var d;if((c.browser.msie&&(/(static|relative)/).test(this.css("position")))||(/absolute/).test(this.css("position"))){d=this.parents().filter(function(){return(/(relative|absolute|fixed)/).test(c.curCSS(this,"position",1))&&(/(auto|scroll)/).test(c.curCSS(this,"overflow",1)+c.curCSS(this,"overflow-y",1)+c.curCSS(this,"overflow-x",1))}).eq(0)}else{d=this.parents().filter(function(){return(/(auto|scroll)/).test(c.curCSS(this,"overflow",1)+c.curCSS(this,"overflow-y",1)+c.curCSS(this,"overflow-x",1))}).eq(0)}return(/fixed/).test(this.css("position"))||!d.length?c(document):d},zIndex:function(f){if(f!==a){return this.css("zIndex",f)}if(this.length){var g=c(this[0]),d,e;while(g.length&&g[0]!==document){d=g.css("position");if(d==="absolute"||d==="relative"||d==="fixed"){e=parseInt(g.css("zIndex"));if(!isNaN(e)&&e!=0){return e}}g=g.parent()}}return 0},disableSelection:function(){return this.bind("mousedown.ui-disableSelection selectstart.ui-disableSelection",function(d){d.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}});c.each(["Width","Height"],function(e,h){var j=h==="Width"?["Left","Right"]:["Top","Bottom"],g=h.toLowerCase(),f={innerWidth:c.fn.innerWidth,innerHeight:c.fn.innerHeight,outerWidth:c.fn.outerWidth,outerHeight:c.fn.outerHeight};function d(m,l,i,k){c.each(j,function(){l-=parseFloat(c.curCSS(m,"padding"+this,true))||0;if(i){l-=parseFloat(c.curCSS(m,"border"+this+"Width",true))||0}if(k){l-=parseFloat(c.curCSS(m,"margin"+this,true))||0}});return l}c.fn["inner"+h]=function(i){if(i===a){return f["inner"+h].call(this)}return this.each(function(){c.style(this,g,d(this,i)+"px")})};c.fn["outer"+h]=function(k,i){if(typeof k!=="number"){return f["outer"+h].call(this,k)}return this.each(function(){c.style(this,g,d(this,k,true,i)+"px")})}});function b(d){return !c(d).parents().andSelf().filter(function(){return c.curCSS(this,"visibility")==="hidden"||c.expr.filters.hidden(this)}).length}c.extend(c.expr[":"],{data:function(e,d,f){return !!c.data(e,f[3])},focusable:function(e){var i=e.nodeName.toLowerCase(),f=c.attr(e,"tabindex");if("area"===i){var g=e.parentNode,d=g.name,h;if(!e.href||!d||g.nodeName.toLowerCase()!=="map"){return false}h=c("img[usemap=#"+d+"]")[0];return !!h&&b(h)}return(/input|select|textarea|button|object/.test(i)?!e.disabled:"a"==i?e.href||!isNaN(f):!isNaN(f))&&b(e)},tabbable:function(d){var e=c.attr(d,"tabindex");return(isNaN(e)||e>=0)&&c(d).is(":focusable")}});c(function(){var e=document.createElement("div"),d=document.body;c.extend(e.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0});c.support.minHeight=d.appendChild(e).offsetHeight===100;d.removeChild(e).style.display="none"});c.extend(c.ui,{plugin:{add:function(f,e,g){var h=c.ui[f].prototype;for(var d in g){h.plugins[d]=h.plugins[d]||[];h.plugins[d].push([e,g[d]])}},call:function(g,h,e){var f=g.plugins[h];if(!f||!g.element[0].parentNode){return}for(var d=0;d<f.length;d++){if(g.options[f[d][0]]){f[d][1].apply(g.element,e)}}}},contains:function(d,e){return document.compareDocumentPosition?d.compareDocumentPosition(e)&16:d!==e&&d.contains(e)},hasScroll:function(f,e){if(c(f).css("overflow")==="hidden"){return false}var d=(e&&e==="left")?"scrollLeft":"scrollTop",g=false;if(f[d]>0){return true}f[d]=1;g=(f[d]>0);f[d]=0;return g},isOverAxis:function(f,d,e){return(f>d)&&(f<(d+e))},isOver:function(e,d,h,g,f,i){return c.ui.isOverAxis(e,h,f)&&c.ui.isOverAxis(d,g,i)}})})(jQuery);
/*
 * jQuery UI Widget 1.8.5
 *
 * Copyright 2010, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Widget
 */
(function(d,b){if(d.cleanData){var c=d.cleanData;d.cleanData=function(g){for(var e=0,f;(f=g[e])!=null;e++){d(f).triggerHandler("remove")}c(g)}}else{var a=d.fn.remove;d.fn.remove=function(e,f){return this.each(function(){if(!f){if(!e||d.filter(e,[this]).length){d("*",this).add([this]).each(function(){d(this).triggerHandler("remove")})}}return a.call(d(this),e,f)})}}d.widget=function(i,e,j){var h=i.split(".")[0],f;i=i.split(".")[1];f=h+"-"+i;if(!j){j=e;e=d.Widget}d.expr[":"][f]=function(k){return !!d.data(k,i)};d[h]=d[h]||{};d[h][i]=function(l,k){if(arguments.length){this._createWidget(l,k)}};var g=new e();g.options=d.extend(true,{},g.options);d[h][i].prototype=d.extend(true,g,{namespace:h,widgetName:i,widgetEventPrefix:d[h][i].prototype.widgetEventPrefix||i,widgetBaseClass:f},j);d.widget.bridge(i,d[h][i])};d.widget.bridge=function(f,e){d.fn[f]=function(j){var h=typeof j==="string",g=Array.prototype.slice.call(arguments,1),i=this;j=!h&&g.length?d.extend.apply(null,[true,j].concat(g)):j;if(h&&j.substring(0,1)==="_"){return i}if(h){this.each(function(){var l=d.data(this,f);if(!l){throw"cannot call methods on "+f+" prior to initialization; attempted to call method '"+j+"'"}if(!d.isFunction(l[j])){throw"no such method '"+j+"' for "+f+" widget instance"}var k=l[j].apply(l,g);if(k!==l&&k!==b){i=k;return false}})}else{this.each(function(){var k=d.data(this,f);if(k){k.option(j||{})._init()}else{d.data(this,f,new e(j,this))}})}return i}};d.Widget=function(f,e){if(arguments.length){this._createWidget(f,e)}};d.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:false},_createWidget:function(f,e){d.data(e,this.widgetName,this);this.element=d(e);this.options=d.extend(true,{},this.options,d.metadata&&d.metadata.get(e)[this.widgetName],f);var g=this;this.element.bind("remove."+this.widgetName,function(){g.destroy()});this._create();this._init()},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName);this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled")},widget:function(){return this.element},option:function(h,e){var g=h,f=this;if(arguments.length===0){return d.extend({},f.options)}if(typeof h==="string"){if(e===b){return this.options[h]}g={};g[h]=e}d.each(g,function(i,j){f._setOption(i,j)});return f},_setOption:function(e,f){this.options[e]=f;if(e==="disabled"){this.widget()[f?"addClass":"removeClass"](this.widgetBaseClass+"-disabled ui-state-disabled").attr("aria-disabled",f)}return this},enable:function(){return this._setOption("disabled",false)},disable:function(){return this._setOption("disabled",true)},_trigger:function(j,k,e){var g=this.options[j];k=d.Event(k);k.type=(j===this.widgetEventPrefix?j:this.widgetEventPrefix+j).toLowerCase();e=e||{};if(k.originalEvent){for(var f=d.event.props.length,h;f;){h=d.event.props[--f];k[h]=k.originalEvent[h]}}this.element.trigger(k,e);return !(d.isFunction(g)&&g.call(this.element[0],k,e)===false||k.isDefaultPrevented())}}})(jQuery);
/*
 * jQuery UI Mouse 1.8.5
 *
 * Copyright 2010, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Mouse
 *
 * Depends:
 *	jquery.ui.widget.js
 */
(function(b,a){b.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var c=this;this.element.bind("mousedown."+this.widgetName,function(d){return c._mouseDown(d)}).bind("click."+this.widgetName,function(d){if(c._preventClickEvent){c._preventClickEvent=false;d.stopImmediatePropagation();return false}});this.started=false},_mouseDestroy:function(){this.element.unbind("."+this.widgetName)},_mouseDown:function(d){d.originalEvent=d.originalEvent||{};if(d.originalEvent.mouseHandled){return}(this._mouseStarted&&this._mouseUp(d));this._mouseDownEvent=d;if(this.element[0]&&this.element[0].setCapture){this.element[0].setCapture()}var e=this,c=(d.which==1),f=(typeof this.options.cancel=="string"?b(d.target).parents().add(d.target).filter(this.options.cancel).length:false);if(!c||f||!this._mouseCapture(d)){return true}this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet){this._mouseDelayTimer=setTimeout(function(){e.mouseDelayMet=true},this.options.delay)}if(this._mouseDistanceMet(d)&&this._mouseDelayMet(d)){this._mouseStarted=(this._mouseStart(d)!==false);if(!this._mouseStarted){d.preventDefault();return true}}this._mouseMoveDelegate=function(g){return e._mouseMove(g)};this._mouseUpDelegate=function(g){return e._mouseUp(g)};b(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate);(b.browser.safari||d.preventDefault());d.originalEvent.mouseHandled=true;return true},_mouseMove:function(c){if(this._mouseStarted){this._mouseDrag(c);return c.preventDefault()}if(this._mouseDistanceMet(c)&&this._mouseDelayMet(c)){this._mouseStarted=(this._mouseStart(this._mouseDownEvent,c)!==false);(this._mouseStarted?this._mouseDrag(c):this._mouseUp(c))}return !this._mouseStarted},_mouseUp:function(c){b(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=false;this._preventClickEvent=(c.target==this._mouseDownEvent.target);this._mouseStop(c)}if(document.releaseCapture){document.releaseCapture()}return false},_mouseDistanceMet:function(c){return(Math.max(Math.abs(this._mouseDownEvent.pageX-c.pageX),Math.abs(this._mouseDownEvent.pageY-c.pageY))>=this.options.distance)},_mouseDelayMet:function(c){return this.mouseDelayMet},_mouseStart:function(c){},_mouseDrag:function(c){},_mouseStop:function(c){},_mouseCapture:function(c){return true}})})(jQuery);(function(c,a){c.ui=c.ui||{};var f=/left|center|right/,b=/top|center|bottom/,d="center",g=c.fn.position,e=c.fn.offset;c.fn.position=function(i){if(!i||!i.of){return g.apply(this,arguments)}i=c.extend({},i);var n=c(i.of),m=n[0],j=(i.collision||"flip").split(" "),l=i.offset?i.offset.split(" "):[0,0],h,k,o;if(m.nodeType===9){h=n.width();k=n.height();o={top:0,left:0}}else{if(m.scrollTo&&m.document){h=n.width();k=n.height();o={top:n.scrollTop(),left:n.scrollLeft()}}else{if(m.preventDefault){i.at="left top";h=k=0;o={top:i.of.pageY,left:i.of.pageX}}else{h=n.outerWidth();k=n.outerHeight();o=n.offset()}}}c.each(["my","at"],function(){var p=(i[this]||"").split(" ");if(p.length===1){p=f.test(p[0])?p.concat([d]):b.test(p[0])?[d].concat(p):[d,d]}p[0]=f.test(p[0])?p[0]:d;p[1]=b.test(p[1])?p[1]:d;i[this]=p});if(j.length===1){j[1]=j[0]}l[0]=parseInt(l[0],10)||0;if(l.length===1){l[1]=l[0]}l[1]=parseInt(l[1],10)||0;if(i.at[0]==="right"){o.left+=h}else{if(i.at[0]===d){o.left+=h/2}}if(i.at[1]==="bottom"){o.top+=k}else{if(i.at[1]===d){o.top+=k/2}}o.left+=l[0];o.top+=l[1];return this.each(function(){var s=c(this),q=s.outerWidth(),u=s.outerHeight(),w=parseInt(c.curCSS(this,"marginLeft",true))||0,t=parseInt(c.curCSS(this,"marginTop",true))||0,v=q+w+parseInt(c.curCSS(this,"marginRight",true))||0,p=u+t+parseInt(c.curCSS(this,"marginBottom",true))||0,r=c.extend({},o),x;if(i.my[0]==="right"){r.left-=q}else{if(i.my[0]===d){r.left-=q/2}}if(i.my[1]==="bottom"){r.top-=u}else{if(i.my[1]===d){r.top-=u/2}}r.left=parseInt(r.left);r.top=parseInt(r.top);x={left:r.left-w,top:r.top-t};c.each(["left","top"],function(y,z){if(c.ui.position[j[y]]){c.ui.position[j[y]][z](r,{targetWidth:h,targetHeight:k,elemWidth:q,elemHeight:u,collisionPosition:x,collisionWidth:v,collisionHeight:p,offset:l,my:i.my,at:i.at})}});if(c.fn.bgiframe){s.bgiframe()}s.offset(c.extend(r,{using:i.using}))})};c.ui.position={fit:{left:function(h,i){var j=c(window),k=i.collisionPosition.left+i.collisionWidth-j.width()-j.scrollLeft();h.left=k>0?h.left-k:Math.max(h.left-i.collisionPosition.left,h.left)},top:function(h,i){var j=c(window),k=i.collisionPosition.top+i.collisionHeight-j.height()-j.scrollTop();h.top=k>0?h.top-k:Math.max(h.top-i.collisionPosition.top,h.top)}},flip:{left:function(i,h){if(h.at[0]===d){return}var j=c(window),k=h.collisionPosition.left+h.collisionWidth-j.width()-j.scrollLeft(),n=h.my[0]==="left"?-h.elemWidth:h.my[0]==="right"?h.elemWidth:0,m=h.at[0]==="left"?h.targetWidth:-h.targetWidth,l=-2*h.offset[0];i.left+=h.collisionPosition.left<0?n+m+l:k>0?n+m+l:0},top:function(i,h){if(h.at[1]===d){return}var j=c(window),k=h.collisionPosition.top+h.collisionHeight-j.height()-j.scrollTop(),n=h.my[1]==="top"?-h.elemHeight:h.my[1]==="bottom"?h.elemHeight:0,m=h.at[1]==="top"?h.targetHeight:-h.targetHeight,l=-2*h.offset[1];i.top+=h.collisionPosition.top<0?n+m+l:k>0?n+m+l:0}}};if(!c.offset.setOffset){c.offset.setOffset=function(k,i){if(/static/.test(c.curCSS(k,"position"))){k.style.position="relative"}var m=c(k),l=m.offset(),n=parseInt(c.curCSS(k,"top",true),10)||0,h=parseInt(c.curCSS(k,"left",true),10)||0,j={top:(i.top-l.top)+n,left:(i.left-l.left)+h};if("using" in i){i.using.call(k,j)}else{m.css(j)}};c.fn.offset=function(i){var h=this[0];if(!h||!h.ownerDocument){return null}if(i){return this.each(function(){c.offset.setOffset(this,i)})}return e.call(this)}}}(jQuery));(function(c,a){var b=5;c.widget("ui.slider",c.ui.mouse,{widgetEventPrefix:"slide",options:{animate:false,distance:0,max:100,min:0,orientation:"horizontal",range:false,step:1,value:0,values:null},_create:function(){var d=this,e=this.options;this._keySliding=false;this._mouseSliding=false;this._animateOff=true;this._handleIndex=null;this._detectOrientation();this._mouseInit();this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all");if(e.disabled){this.element.addClass("ui-slider-disabled ui-disabled")}this.range=c([]);if(e.range){if(e.range===true){this.range=c("<div></div>");if(!e.values){e.values=[this._valueMin(),this._valueMin()]}if(e.values.length&&e.values.length!==2){e.values=[e.values[0],e.values[0]]}}else{this.range=c("<div></div>")}this.range.appendTo(this.element).addClass("ui-slider-range");if(e.range==="min"||e.range==="max"){this.range.addClass("ui-slider-range-"+e.range)}this.range.addClass("ui-widget-header")}if(c(".ui-slider-handle",this.element).length===0){c("<a href='#'></a>").appendTo(this.element).addClass("ui-slider-handle")}if(e.values&&e.values.length){while(c(".ui-slider-handle",this.element).length<e.values.length){c("<a href='#'></a>").appendTo(this.element).addClass("ui-slider-handle")}}this.handles=c(".ui-slider-handle",this.element).addClass("ui-state-default ui-corner-all");this.handle=this.handles.eq(0);this.handles.add(this.range).filter("a").click(function(f){f.preventDefault()}).hover(function(){if(!e.disabled){c(this).addClass("ui-state-hover")}},function(){c(this).removeClass("ui-state-hover")}).focus(function(){if(!e.disabled){c(".ui-slider .ui-state-focus").removeClass("ui-state-focus");c(this).addClass("ui-state-focus")}else{c(this).blur()}}).blur(function(){c(this).removeClass("ui-state-focus")});this.handles.each(function(f){c(this).data("index.ui-slider-handle",f)});this.handles.keydown(function(j){var h=true,g=c(this).data("index.ui-slider-handle"),k,l,i,f;if(d.options.disabled){return}switch(j.keyCode){case c.ui.keyCode.HOME:case c.ui.keyCode.END:case c.ui.keyCode.PAGE_UP:case c.ui.keyCode.PAGE_DOWN:case c.ui.keyCode.UP:case c.ui.keyCode.RIGHT:case c.ui.keyCode.DOWN:case c.ui.keyCode.LEFT:h=false;if(!d._keySliding){d._keySliding=true;c(this).addClass("ui-state-active");k=d._start(j,g);if(k===false){return}}break}f=d.options.step;if(d.options.values&&d.options.values.length){l=i=d.values(g)}else{l=i=d.value()}switch(j.keyCode){case c.ui.keyCode.HOME:i=d._valueMin();break;case c.ui.keyCode.END:i=d._valueMax();break;case c.ui.keyCode.PAGE_UP:i=d._trimAlignValue(l+((d._valueMax()-d._valueMin())/b));break;case c.ui.keyCode.PAGE_DOWN:i=d._trimAlignValue(l-((d._valueMax()-d._valueMin())/b));break;case c.ui.keyCode.UP:case c.ui.keyCode.RIGHT:if(l===d._valueMax()){return}i=d._trimAlignValue(l+f);break;case c.ui.keyCode.DOWN:case c.ui.keyCode.LEFT:if(l===d._valueMin()){return}i=d._trimAlignValue(l-f);break}d._slide(j,g,i);return h}).keyup(function(g){var f=c(this).data("index.ui-slider-handle");if(d._keySliding){d._keySliding=false;d._stop(g,f);d._change(g,f);c(this).removeClass("ui-state-active")}});this._refreshValue();this._animateOff=false},destroy:function(){this.handles.remove();this.range.remove();this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all").removeData("slider").unbind(".slider");this._mouseDestroy();return this},_mouseCapture:function(k){var g=this.options,h,i,j,f,e,m,l,d,n;if(g.disabled){return false}this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()};this.elementOffset=this.element.offset();h={x:k.pageX,y:k.pageY};i=this._normValueFromMouse(h);j=this._valueMax()-this._valueMin()+1;e=this;this.handles.each(function(p){var o=Math.abs(i-e.values(p));if(j>o){j=o;f=c(this);m=p}});if(g.range===true&&this.values(1)===g.min){m+=1;f=c(this.handles[m])}l=this._start(k,m);if(l===false){return false}this._mouseSliding=true;e._handleIndex=m;f.addClass("ui-state-active").focus();d=f.offset();n=!c(k.target).parents().andSelf().is(".ui-slider-handle");this._clickOffset=n?{left:0,top:0}:{left:k.pageX-d.left-(f.width()/2),top:k.pageY-d.top-(f.height()/2)-(parseInt(f.css("borderTopWidth"),10)||0)-(parseInt(f.css("borderBottomWidth"),10)||0)+(parseInt(f.css("marginTop"),10)||0)};this._slide(k,m,i);this._animateOff=true;return true},_mouseStart:function(d){return true},_mouseDrag:function(e){var d={x:e.pageX,y:e.pageY},f=this._normValueFromMouse(d);this._slide(e,this._handleIndex,f);return false},_mouseStop:function(d){this.handles.removeClass("ui-state-active");this._mouseSliding=false;this._stop(d,this._handleIndex);this._change(d,this._handleIndex);this._handleIndex=null;this._clickOffset=null;this._animateOff=false;return false},_detectOrientation:function(){this.orientation=(this.options.orientation==="vertical")?"vertical":"horizontal"},_normValueFromMouse:function(f){var i,g,h,e,d;if(this.orientation==="horizontal"){i=this.elementSize.width;g=f.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)}else{i=this.elementSize.height;g=f.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)}h=(g/i);if(h>1){h=1}if(h<0){h=0}if(this.orientation==="vertical"){h=1-h}e=this._valueMax()-this._valueMin();d=this._valueMin()+h*e;return this._trimAlignValue(d)},_start:function(e,d){var f={handle:this.handles[d],value:this.value()};if(this.options.values&&this.options.values.length){f.value=this.values(d);f.values=this.values()}return this._trigger("start",e,f)},_slide:function(g,i,e){var d,f,h;if(this.options.values&&this.options.values.length){d=this.values(i?0:1);if((this.options.values.length===2&&this.options.range===true)&&((i===0&&e>d)||(i===1&&e<d))){e=d}if(e!==this.values(i)){f=this.values();f[i]=e;h=this._trigger("slide",g,{handle:this.handles[i],value:e,values:f});d=this.values(i?0:1);if(h!==false){this.values(i,e,true)}}}else{if(e!==this.value()){h=this._trigger("slide",g,{handle:this.handles[i],value:e});if(h!==false){this.value(e)}}}},_stop:function(e,d){var f={handle:this.handles[d],value:this.value()};if(this.options.values&&this.options.values.length){f.value=this.values(d);f.values=this.values()}this._trigger("stop",e,f)},_change:function(e,d){if(!this._keySliding&&!this._mouseSliding){var f={handle:this.handles[d],value:this.value()};if(this.options.values&&this.options.values.length){f.value=this.values(d);f.values=this.values()}this._trigger("change",e,f)}},value:function(d){if(arguments.length){this.options.value=this._trimAlignValue(d);this._refreshValue();this._change(null,0)}return this._value()},values:function(g,f){var e,d,h;if(arguments.length>1){this.options.values[g]=this._trimAlignValue(f);this._refreshValue();this._change(null,g)}if(arguments.length){if(c.isArray(arguments[0])){e=this.options.values;d=arguments[0];for(h=0;h<e.length;h+=1){e[h]=this._trimAlignValue(d[h]);this._change(null,h)}this._refreshValue()}else{if(this.options.values&&this.options.values.length){return this._values(g)}else{return this.value()}}}else{return this._values()}},_setOption:function(g,d){var e,f=0;if(c.isArray(this.options.values)){f=this.options.values.length}c.Widget.prototype._setOption.apply(this,arguments);switch(g){case"disabled":if(d){this.handles.filter(".ui-state-focus").blur();this.handles.removeClass("ui-state-hover");this.handles.attr("disabled","disabled");this.element.addClass("ui-disabled")}else{this.handles.removeAttr("disabled");this.element.removeClass("ui-disabled")}break;case"orientation":this._detectOrientation();this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation);this._refreshValue();break;case"value":this._animateOff=true;this._refreshValue();this._change(null,0);this._animateOff=false;break;case"values":this._animateOff=true;this._refreshValue();for(e=0;e<f;e+=1){this._change(null,e)}this._animateOff=false;break}},_value:function(){var d=this.options.value;d=this._trimAlignValue(d);return d},_values:function(f){var g,e,d;if(arguments.length){g=this.options.values[f];g=this._trimAlignValue(g);return g}else{e=this.options.values.slice();for(d=0;d<e.length;d+=1){e[d]=this._trimAlignValue(e[d])}return e}},_trimAlignValue:function(e){if(e<this._valueMin()){return this._valueMin()}if(e>this._valueMax()){return this._valueMax()}var f=(this.options.step>0)?this.options.step:1,d=e%f,g=e-d;if(Math.abs(d)*2>=f){g+=(d>0)?f:(-f)}return parseFloat(g.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var d=this.options.range,g=this.options,e=this,i=(!this._animateOff)?g.animate:false,j,m={},k,f,l,h;if(this.options.values&&this.options.values.length){this.handles.each(function(n,o){j=(e.values(n)-e._valueMin())/(e._valueMax()-e._valueMin())*100;m[e.orientation==="horizontal"?"left":"bottom"]=j+"%";c(this).stop(1,1)[i?"animate":"css"](m,g.animate);if(e.options.range===true){if(e.orientation==="horizontal"){if(n===0){e.range.stop(1,1)[i?"animate":"css"]({left:j+"%"},g.animate)}if(n===1){e.range[i?"animate":"css"]({width:(j-k)+"%"},{queue:false,duration:g.animate})}}else{if(n===0){e.range.stop(1,1)[i?"animate":"css"]({bottom:(j)+"%"},g.animate)}if(n===1){e.range[i?"animate":"css"]({height:(j-k)+"%"},{queue:false,duration:g.animate})}}}k=j})}else{f=this.value();l=this._valueMin();h=this._valueMax();j=(h!==l)?(f-l)/(h-l)*100:0;m[e.orientation==="horizontal"?"left":"bottom"]=j+"%";this.handle.stop(1,1)[i?"animate":"css"](m,g.animate);if(d==="min"&&this.orientation==="horizontal"){this.range.stop(1,1)[i?"animate":"css"]({width:j+"%"},g.animate)}if(d==="max"&&this.orientation==="horizontal"){this.range[i?"animate":"css"]({width:(100-j)+"%"},{queue:false,duration:g.animate})}if(d==="min"&&this.orientation==="vertical"){this.range.stop(1,1)[i?"animate":"css"]({height:j+"%"},g.animate)}if(d==="max"&&this.orientation==="vertical"){this.range[i?"animate":"css"]({height:(100-j)+"%"},{queue:false,duration:g.animate})}}}});c.extend(c.ui.slider,{version:"1.8.5"})}(jQuery));(function(c,b){var a="ui-dialog ui-widget ui-widget-content ui-corner-all ";c.widget("ui.dialog",{options:{autoOpen:true,buttons:{},closeOnEscape:true,closeText:"close",dialogClass:"",draggable:true,hide:null,height:"auto",maxHeight:false,maxWidth:false,minHeight:150,minWidth:150,modal:false,position:{my:"center",at:"center",of:window,collision:"fit",using:function(e){var d=c(this).css(e).offset().top;if(d<0){c(this).css("top",e.top-d)}}},resizable:true,show:null,stack:true,title:"",width:300,zIndex:1000},_create:function(){this.originalTitle=this.element.attr("title");if(typeof this.originalTitle!=="string"){this.originalTitle=""}this.options.title=this.options.title||this.originalTitle;var g=this,f=g.options,h=f.title||"&#160;",j=c.ui.dialog.getTitleId(g.element),l=(g.uiDialog=c("<div></div>")).appendTo(document.body).hide().addClass(a+f.dialogClass).css({zIndex:f.zIndex}).attr("tabIndex",-1).css("outline",0).keydown(function(n){if(f.closeOnEscape&&n.keyCode&&n.keyCode===c.ui.keyCode.ESCAPE){g.close(n);n.preventDefault()}}).attr({role:"dialog","aria-labelledby":j}).mousedown(function(n){g.moveToTop(false,n)}),k=g.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(l),e=(g.uiDialogTitlebar=c("<div></div>")).addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(l),d=c('<a href="#"></a>').addClass("ui-dialog-titlebar-close ui-corner-all").attr("role","button").hover(function(){d.addClass("ui-state-hover")},function(){d.removeClass("ui-state-hover")}).focus(function(){d.addClass("ui-state-focus")}).blur(function(){d.removeClass("ui-state-focus")}).click(function(n){g.close(n);return false}).appendTo(e),m=(g.uiDialogTitlebarCloseText=c("<span></span>")).addClass("ui-icon ui-icon-closethick").text(f.closeText).appendTo(d),i=c("<span></span>").addClass("ui-dialog-title").attr("id",j).html(h).prependTo(e);if(c.isFunction(f.beforeclose)&&!c.isFunction(f.beforeClose)){f.beforeClose=f.beforeclose}e.find("*").add(e).disableSelection();if(f.draggable&&c.fn.draggable){g._makeDraggable()}if(f.resizable&&c.fn.resizable){g._makeResizable()}g._createButtons(f.buttons);g._isOpen=false;if(c.fn.bgiframe){l.bgiframe()}},_init:function(){if(this.options.autoOpen){this.open()}},destroy:function(){var d=this;if(d.overlay){d.overlay.destroy()}d.uiDialog.hide();d.element.unbind(".dialog").removeData("dialog").removeClass("ui-dialog-content ui-widget-content").hide().appendTo("body");d.uiDialog.remove();if(d.originalTitle){d.element.attr("title",d.originalTitle)}return d},widget:function(){return this.uiDialog},close:function(e){var f=this,d;if(false===f._trigger("beforeClose",e)){return}if(f.overlay){f.overlay.destroy()}f.uiDialog.unbind("keypress.ui-dialog");f._isOpen=false;if(f.options.hide){f.uiDialog.hide(f.options.hide,function(){f._trigger("close",e)})}else{f.uiDialog.hide();f._trigger("close",e)}c.ui.dialog.overlay.resize();if(f.options.modal){d=0;c(".ui-dialog").each(function(){if(this!==f.uiDialog[0]){d=Math.max(d,c(this).css("z-index"))}});c.ui.dialog.maxZ=d}return f},isOpen:function(){return this._isOpen},moveToTop:function(d,e){var f=this,g=f.options,h;if((g.modal&&!d)||(!g.stack&&!g.modal)){return f._trigger("focus",e)}if(g.zIndex>c.ui.dialog.maxZ){c.ui.dialog.maxZ=g.zIndex}if(f.overlay){c.ui.dialog.maxZ+=1;f.overlay.$el.css("z-index",c.ui.dialog.overlay.maxZ=c.ui.dialog.maxZ)}h={scrollTop:f.element.attr("scrollTop"),scrollLeft:f.element.attr("scrollLeft")};c.ui.dialog.maxZ+=1;f.uiDialog.css("z-index",c.ui.dialog.maxZ);f.element.attr(h);f._trigger("focus",e);return f},open:function(){if(this._isOpen){return}var d=this,e=d.options,f=d.uiDialog;d.overlay=e.modal?new c.ui.dialog.overlay(d):null;if(f.next().length){f.appendTo("body")}d._size();d._position(e.position);f.show(e.show);d.moveToTop(true);if(e.modal){f.bind("keypress.ui-dialog",function(g){if(g.keyCode!==c.ui.keyCode.TAB){return}var h=c(":tabbable",this),i=h.filter(":first"),j=h.filter(":last");if(g.target===j[0]&&!g.shiftKey){i.focus(1);return false}else{if(g.target===i[0]&&g.shiftKey){j.focus(1);return false}}})}c(d.element.find(":tabbable").get().concat(f.find(".ui-dialog-buttonpane :tabbable").get().concat(f.get()))).eq(0).focus();d._isOpen=true;d._trigger("open");return d},_createButtons:function(h){var f=this,d=false,g=c("<div></div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),e=c("<div></div>").addClass("ui-dialog-buttonset").appendTo(g);f.uiDialog.find(".ui-dialog-buttonpane").remove();if(typeof h==="object"&&h!==null){c.each(h,function(){return !(d=true)})}if(d){c.each(h,function(k,i){i=c.isFunction(i)?{click:i,text:k}:i;var j=c("<button></button>",i).unbind("click").click(function(){i.click.apply(f.element[0],arguments)}).appendTo(e);if(c.fn.button){j.button()}});g.appendTo(f.uiDialog)}},_makeDraggable:function(){var f=this,g=f.options,e=c(document),h;function d(i){return{position:i.position,offset:i.offset}}f.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(j,i){h=g.height==="auto"?"auto":c(this).height();c(this).height(c(this).height()).addClass("ui-dialog-dragging");f._trigger("dragStart",j,d(i))},drag:function(j,i){f._trigger("drag",j,d(i))},stop:function(j,i){g.position=[i.position.left-e.scrollLeft(),i.position.top-e.scrollTop()];c(this).removeClass("ui-dialog-dragging").height(h);f._trigger("dragStop",j,d(i));c.ui.dialog.overlay.resize()}})},_makeResizable:function(i){i=(i===b?this.options.resizable:i);var e=this,d=e.options,g=e.uiDialog.css("position"),h=(typeof i==="string"?i:"n,e,s,w,se,sw,ne,nw");function f(j){return{originalPosition:j.originalPosition,originalSize:j.originalSize,position:j.position,size:j.size}}e.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:e.element,maxWidth:d.maxWidth,maxHeight:d.maxHeight,minWidth:d.minWidth,minHeight:e._minHeight(),handles:h,start:function(k,j){c(this).addClass("ui-dialog-resizing");e._trigger("resizeStart",k,f(j))},resize:function(k,j){e._trigger("resize",k,f(j))},stop:function(k,j){c(this).removeClass("ui-dialog-resizing");d.height=c(this).height();d.width=c(this).width();e._trigger("resizeStop",k,f(j));c.ui.dialog.overlay.resize()}}).css("position",g).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se")},_minHeight:function(){var d=this.options;if(d.height==="auto"){return d.minHeight}else{return Math.min(d.minHeight,d.height)}},_position:function(d){var f=[],g=[0,0],e;if(d){if(typeof d==="string"||(typeof d==="object"&&"0" in d)){f=d.split?d.split(" "):[d[0],d[1]];if(f.length===1){f[1]=f[0]}c.each(["left","top"],function(h,j){if(+f[h]===f[h]){g[h]=f[h];f[h]=j}});d={my:f.join(" "),at:f.join(" "),offset:g.join(" ")}}d=c.extend({},c.ui.dialog.prototype.options.position,d)}else{d=c.ui.dialog.prototype.options.position}e=this.uiDialog.is(":visible");if(!e){this.uiDialog.show()}this.uiDialog.css({top:0,left:0}).position(d);if(!e){this.uiDialog.hide()}},_setOption:function(i,d){var e=this,h=e.uiDialog,f=h.is(":data(resizable)"),g=false;switch(i){case"beforeclose":i="beforeClose";break;case"buttons":e._createButtons(d);g=true;break;case"closeText":e.uiDialogTitlebarCloseText.text(""+d);break;case"dialogClass":h.removeClass(e.options.dialogClass).addClass(a+d);break;case"disabled":if(d){h.addClass("ui-dialog-disabled")}else{h.removeClass("ui-dialog-disabled")}break;case"draggable":if(d){e._makeDraggable()}else{h.draggable("destroy")}break;case"height":g=true;break;case"maxHeight":if(f){h.resizable("option","maxHeight",d)}g=true;break;case"maxWidth":if(f){h.resizable("option","maxWidth",d)}g=true;break;case"minHeight":if(f){h.resizable("option","minHeight",d)}g=true;break;case"minWidth":if(f){h.resizable("option","minWidth",d)}g=true;break;case"position":e._position(d);break;case"resizable":if(f&&!d){h.resizable("destroy")}if(f&&typeof d==="string"){h.resizable("option","handles",d)}if(!f&&d!==false){e._makeResizable(d)}break;case"title":c(".ui-dialog-title",e.uiDialogTitlebar).html(""+(d||"&#160;"));break;case"width":g=true;break}c.Widget.prototype._setOption.apply(e,arguments);if(g){e._size()}},_size:function(){var e=this.options,d;this.element.css({width:"auto",minHeight:0,height:0});if(e.minWidth>e.width){e.width=e.minWidth}d=this.uiDialog.css({height:"auto",width:e.width}).height();this.element.css(e.height==="auto"?{minHeight:Math.max(e.minHeight-d,0),height:c.support.minHeight?"auto":Math.max(e.minHeight-d,0)}:{minHeight:0,height:Math.max(e.height-d,0)}).show();if(this.uiDialog.is(":data(resizable)")){this.uiDialog.resizable("option","minHeight",this._minHeight())}}});c.extend(c.ui.dialog,{version:"1.8.5",uuid:0,maxZ:0,getTitleId:function(e){var d=e.attr("id");if(!d){this.uuid+=1;d=this.uuid}return"ui-dialog-title-"+d},overlay:function(d){this.$el=c.ui.dialog.overlay.create(d)}});c.extend(c.ui.dialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:c.map("focus,mousedown,mouseup,keydown,keypress,click".split(","),function(d){return d+".dialog-overlay"}).join(" "),create:function(e){if(this.instances.length===0){setTimeout(function(){if(c.ui.dialog.overlay.instances.length){c(document).bind(c.ui.dialog.overlay.events,function(f){if(c(f.target).zIndex()<c.ui.dialog.overlay.maxZ){return false}})}},1);c(document).bind("keydown.dialog-overlay",function(f){if(e.options.closeOnEscape&&f.keyCode&&f.keyCode===c.ui.keyCode.ESCAPE){e.close(f);f.preventDefault()}});c(window).bind("resize.dialog-overlay",c.ui.dialog.overlay.resize)}var d=(this.oldInstances.pop()||c("<div></div>").addClass("ui-widget-overlay")).appendTo(document.body).css({width:this.width(),height:this.height()});if(c.fn.bgiframe){d.bgiframe()}this.instances.push(d);return d},destroy:function(d){this.oldInstances.push(this.instances.splice(c.inArray(d,this.instances),1)[0]);if(this.instances.length===0){c([document,window]).unbind(".dialog-overlay")}d.remove();var e=0;c.each(this.instances,function(){e=Math.max(e,this.css("z-index"))});this.maxZ=e},height:function(){var e,d;if(c.browser.msie&&c.browser.version<7){e=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight);d=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight);if(e<d){return c(window).height()+"px"}else{return e+"px"}}else{return c(document).height()+"px"}},width:function(){var d,e;if(c.browser.msie&&c.browser.version<7){d=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth);e=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth);if(d<e){return c(window).width()+"px"}else{return d+"px"}}else{return c(document).width()+"px"}},resize:function(){var d=c([]);c.each(c.ui.dialog.overlay.instances,function(){d=d.add(this)});d.css({width:0,height:0}).css({width:c.ui.dialog.overlay.width(),height:c.ui.dialog.overlay.height()})}});c.extend(c.ui.dialog.overlay.prototype,{destroy:function(){c.ui.dialog.overlay.destroy(this.$el)}})}(jQuery));/*
 * Jcrop v.0.9.8 (minimized)
 * (c) 2008 Kelly Hallman and DeepLiquid.com
 * More information: http://deepliquid.com/content/Jcrop.html
 * Released under MIT License - this header must remain with code
 */
(function(a){a.Jcrop=function(j,s){var j=j,s=s;if(typeof(j)!=="object"){j=a(j)[0]}if(typeof(s)!=="object"){s={}}if(!("trackDocument" in s)){s.trackDocument=a.browser.msie?false:true;if(a.browser.msie&&a.browser.version.split(".")[0]=="8"){s.trackDocument=true}}if(!("keySupport" in s)){s.keySupport=a.browser.msie?false:true}var o={trackDocument:false,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:0.6,borderOpacity:0.4,handleOpacity:0.5,handlePad:5,handleSize:9,handleOffset:5,edgeMargin:14,aspectRatio:0,keySupport:true,cornerHandles:true,sideHandles:true,drawBorders:true,dragEdges:true,boxWidth:0,boxHeight:0,boundary:8,animationDelay:20,swingSpeed:3,allowSelect:true,allowMove:true,allowResize:true,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){}};var B=o;J(s);var ad=a(j);var X=ad.clone().removeAttr("id").css({position:"absolute"});X.width(ad.width());X.height(ad.height());ad.after(X).hide();A(X,B.boxWidth,B.boxHeight);var an=X.width(),x=X.height(),O=a("<div />").width(an).height(x).addClass(u("holder")).css({position:"relative",backgroundColor:B.bgColor}).insertAfter(ad).append(X);if(B.addClass){O.addClass(B.addClass)}var L=a("<img />").attr("src",X.attr("src")).css("position","absolute").width(an).height(x);var q=a("<div />").width(C(100)).height(C(100)).css({zIndex:310,position:"absolute",overflow:"hidden"}).append(L);var ai=a("<div />").width(C(100)).height(C(100)).css("zIndex",320);var k=a("<div />").css({position:"absolute",zIndex:300}).insertBefore(X).append(q,ai);var af=B.boundary;var F=W().width(an+(af*2)).height(x+(af*2)).css({position:"absolute",top:d(-af),left:d(-af),zIndex:290}).mousedown(Y);var am,M,aa,ab;var t,al,S=true;var H=ae(X),D,aj,I,U,b;var n=function(){var ap=0,au=0,aw=0,ax=0,ao,at;function ay(aF){var aF=aD(aF);aw=ap=aF[0];ax=au=aF[1]}function aB(aF){var aF=aD(aF);ao=aF[0]-aw;at=aF[1]-ax;aw=aF[0];ax=aF[1]}function aA(){return[ao,at]}function ar(aH){var aF=aH[0],aG=aH[1];if(0>ap+aF){aF-=aF+ap}if(0>au+aG){aG-=aG+au}if(x<ax+aG){aG+=x-(ax+aG)}if(an<aw+aF){aF+=an-(aw+aF)}ap+=aF;aw+=aF;au+=aG;ax+=aG}function aE(aG){var aF=av();switch(aG){case"ne":return[aF.x2,aF.y];case"nw":return[aF.x,aF.y];case"se":return[aF.x2,aF.y2];case"sw":return[aF.x,aF.y2]}}function av(){if(!B.aspectRatio){return az()}var aF=B.aspectRatio,aI=B.minSize[0]/t,aH=B.minSize[1]/al,aL=B.maxSize[0]/t,aK=B.maxSize[1]/al,aJ=aw-ap,aM=ax-au,aN=Math.abs(aJ),aO=Math.abs(aM),aG=aN/aO,aP,aQ;if(aL==0){aL=an*10}if(aK==0){aK=x*10}if(aG<aF){aQ=ax;w=aO*aF;aP=aJ<0?ap-w:w+ap;if(aP<0){aP=0;h=Math.abs((aP-ap)/aF);aQ=aM<0?au-h:h+au}else{if(aP>an){aP=an;h=Math.abs((aP-ap)/aF);aQ=aM<0?au-h:h+au}}}else{aP=aw;h=aN/aF;aQ=aM<0?au-h:au+h;if(aQ<0){aQ=0;w=Math.abs((aQ-au)*aF);aP=aJ<0?ap-w:w+ap}else{if(aQ>x){aQ=x;w=Math.abs(aQ-au)*aF;aP=aJ<0?ap-w:w+ap}}}if(aP>ap){if(aP-ap<aI){aP=ap+aI}else{if(aP-ap>aL){aP=ap+aL}}if(aQ>au){aQ=au+(aP-ap)/aF}else{aQ=au-(aP-ap)/aF}}else{if(aP<ap){if(ap-aP<aI){aP=ap-aI}else{if(ap-aP>aL){aP=ap-aL}}if(aQ>au){aQ=au+(ap-aP)/aF}else{aQ=au-(ap-aP)/aF}}}if(aP<0){ap-=aP;aP=0}else{if(aP>an){ap-=aP-an;aP=an}}if(aQ<0){au-=aQ;aQ=0}else{if(aQ>x){au-=aQ-x;aQ=x}}return last=aC(aq(ap,au,aP,aQ))}function aD(aF){if(aF[0]<0){aF[0]=0}if(aF[1]<0){aF[1]=0}if(aF[0]>an){aF[0]=an}if(aF[1]>x){aF[1]=x}return[aF[0],aF[1]]}function aq(aF,aH,aG,aJ){var aI=aF,aK=aG,aL=aH,aM=aJ;if(aG<aF){aI=aG;aK=aF}if(aJ<aH){aL=aJ;aM=aH}return[Math.round(aI),Math.round(aL),Math.round(aK),Math.round(aM)]}function az(){var aF=aw-ap;var aG=ax-au;if(am&&(Math.abs(aF)>am)){aw=(aF>0)?(ap+am):(ap-am)}if(M&&(Math.abs(aG)>M)){ax=(aG>0)?(au+M):(au-M)}if(ab&&(Math.abs(aG)<ab)){ax=(aG>0)?(au+ab):(au-ab)}if(aa&&(Math.abs(aF)<aa)){aw=(aF>0)?(ap+aa):(ap-aa)}if(ap<0){aw-=ap;ap-=ap}if(au<0){ax-=au;au-=au}if(aw<0){ap-=aw;aw-=aw}if(ax<0){au-=ax;ax-=ax}if(aw>an){var aH=aw-an;ap-=aH;aw-=aH}if(ax>x){var aH=ax-x;au-=aH;ax-=aH}if(ap>an){var aH=ap-x;ax-=aH;au-=aH}if(au>x){var aH=au-x;ax-=aH;au-=aH}return aC(aq(ap,au,aw,ax))}function aC(aF){return{x:aF[0],y:aF[1],x2:aF[2],y2:aF[3],w:aF[2]-aF[0],h:aF[3]-aF[1]}}return{flipCoords:aq,setPressed:ay,setCurrent:aB,getOffset:aA,moveOffset:ar,getCorner:aE,getFixed:av}}();var r=function(){var aO,ax,aB,aw,av=370;var az={};var ao={};var aD=false;var aJ=B.handleOffset;if(B.drawBorders){az={top:aN("hline").css("top",a.browser.msie?d(-1):d(0)),bottom:aN("hline"),left:aN("vline"),right:aN("vline")}}if(B.dragEdges){ao.t=aE("n");ao.b=aE("s");ao.r=aE("e");ao.l=aE("w")}B.sideHandles&&aA(["n","s","e","w"]);B.cornerHandles&&aA(["sw","nw","ne","se"]);function aN(aS){var aR=a("<div />").css({position:"absolute",opacity:B.borderOpacity}).addClass(u(aS));q.append(aR);return aR}function aG(aR,aT){var aS=a("<div />").mousedown(ag(aR)).css({cursor:aR+"-resize",position:"absolute",zIndex:aT});ai.append(aS);return aS}function aQ(aR){return aG(aR,av++).css({top:d(-aJ+1),left:d(-aJ+1),opacity:B.handleOpacity}).addClass(u("handle"))}function aE(aU){var aV=B.handleSize,aT=aJ,aR=aV,aX=aV,aW=aT,aS=aT;switch(aU){case"n":case"s":aX=C(100);break;case"e":case"w":aR=C(100);break}return aG(aU,av++).width(aX).height(aR).css({top:d(-aW+1),left:d(-aS+1)})}function aA(aR){for(i in aR){ao[aR[i]]=aQ(aR[i])}}function aH(aX){var aT=Math.round((aX.h/2)-aJ),aV=Math.round((aX.w/2)-aJ),aR=west=-aJ+1,aY=aX.w-aJ,aW=aX.h-aJ,aS,aU;"e" in ao&&ao.e.css({top:d(aT),left:d(aY)})&&ao.w.css({top:d(aT)})&&ao.s.css({top:d(aW),left:d(aV)})&&ao.n.css({left:d(aV)});"ne" in ao&&ao.ne.css({left:d(aY)})&&ao.se.css({top:d(aW),left:d(aY)})&&ao.sw.css({top:d(aW)});"b" in ao&&ao.b.css({top:d(aW)})&&ao.r.css({left:d(aY)})}function aP(aS,aR){L.css({top:d(-aR),left:d(-aS)});k.css({top:d(aR),left:d(aS)})}function at(aS,aR){k.width(aS).height(aR)}function aK(){var aR=n.getFixed();n.setPressed([aR.x,aR.y]);n.setCurrent([aR.x2,aR.y2]);aC()}function aC(){if(aw){return aL()}}function aL(){var aR=n.getFixed();at(aR.w,aR.h);aP(aR.x,aR.y);B.drawBorders&&az.right.css({left:d(aR.w-1)})&&az.bottom.css({top:d(aR.h-1)});aD&&aH(aR);aw||aq();B.onChange(ak(aR))}function aq(){k.show();X.css("opacity",B.bgOpacity);aw=true}function ar(){ap();k.hide();X.css("opacity",1);aw=false}function aI(){if(aD){aH(n.getFixed());ai.show()}}function aF(){aD=true;if(B.allowResize){aH(n.getFixed());ai.show();return true}}function ap(){aD=false;ai.hide()}function au(aR){(U=aR)?ap():aF()}function ay(){au(false);aK()}var aM=W().mousedown(ag("move")).css({cursor:"move",position:"absolute",zIndex:360});q.append(aM);ap();return{updateVisible:aC,update:aL,release:ar,refresh:aK,setCursor:function(aR){aM.css("cursor",aR)},enableHandles:aF,enableOnly:function(){aD=true},showHandles:aI,disableHandles:ap,animMode:au,done:ay}}();var l=function(){var ao=function(){},ar=function(){},ap=B.trackDocument;if(!ap){F.mousemove(at).mouseup(ax).mouseout(ax)}function aw(){F.css({zIndex:450});if(ap){a(document).mousemove(at).mouseup(ax)}}function au(){F.css({zIndex:290});if(ap){a(document).unbind("mousemove",at).unbind("mouseup",ax)}}function at(ay){ao(R(ay))}function ax(ay){ay.preventDefault();ay.stopPropagation();if(D){D=false;ar(R(ay));B.onSelect(ak(n.getFixed()));au();ao=function(){};ar=function(){}}return false}function aq(ay,az){D=true;ao=ay;ar=az;aw();return false}function av(ay){F.css("cursor",ay)}X.before(F);return{activateHandlers:aq,setCursor:av}}();var K=function(){var at=a('<input type="radio" />').css({position:"absolute",left:"-30px"}).keypress(aq).blur(ao),au=a("<div />").css({position:"absolute",overflow:"hidden"}).append(at);function ap(){if(B.keySupport){at.show();at.focus()}}function ao(av){at.hide()}function ar(ax,aw,av){if(B.allowMove){n.moveOffset([aw,av]);r.updateVisible()}ax.preventDefault();ax.stopPropagation()}function aq(aw){if(aw.ctrlKey){return true}b=aw.shiftKey?true:false;var av=b?10:1;switch(aw.keyCode){case 37:ar(aw,-av,0);break;case 39:ar(aw,av,0);break;case 38:ar(aw,0,-av);break;case 40:ar(aw,0,av);break;case 27:r.release();break;case 9:return true}return nothing(aw)}if(B.keySupport){au.insertBefore(X)}return{watchKeys:ap}}();function d(ao){return""+parseInt(ao)+"px"}function C(ao){return""+parseInt(ao)+"%"}function u(ao){return B.baseClass+"-"+ao}function ae(ap){var ao=a(ap).offset();return[ao.left,ao.top]}function R(ao){return[(ao.pageX-H[0]),(ao.pageY-H[1])]}function ah(ao){if(ao!=aj){l.setCursor(ao);aj=ao}}function G(aq,ap){H=ae(X);l.setCursor(aq=="move"?aq:aq+"-resize");if(aq=="move"){return l.activateHandlers(p(ap),e)}var ar=n.getFixed();var ao=V(aq);var at=n.getCorner(V(ao));n.setPressed(n.getCorner(ao));n.setCurrent(at);l.activateHandlers(ac(aq,ar),e)}function ac(ap,ao){return function(aq){if(!B.aspectRatio){switch(ap){case"e":aq[1]=ao.y2;break;case"w":aq[1]=ao.y2;break;case"n":aq[0]=ao.x2;break;case"s":aq[0]=ao.x2;break}}else{switch(ap){case"e":aq[1]=ao.y+1;break;case"w":aq[1]=ao.y+1;break;case"n":aq[0]=ao.x+1;break;case"s":aq[0]=ao.x+1;break}}n.setCurrent(aq);r.update()}}function p(ao){var ap=ao;K.watchKeys();return function(aq){n.moveOffset([aq[0]-ap[0],aq[1]-ap[1]]);ap=aq;r.update()}}function V(ao){switch(ao){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function ag(ao){return function(ap){if(B.disabled){return false}if((ao=="move")&&!B.allowMove){return false}D=true;G(ao,R(ap));ap.stopPropagation();ap.preventDefault();return false}}function A(ap,at,ao){var aq=ap.width(),ar=ap.height();if((aq>at)&&at>0){aq=at;ar=(at/ap.width())*ap.height()}if((ar>ao)&&ao>0){ar=ao;aq=(ao/ap.height())*ap.width()}t=ap.width()/aq;al=ap.height()/ar;ap.width(aq).height(ar)}function ak(ao){return{x:parseInt(ao.x*t),y:parseInt(ao.y*al),x2:parseInt(ao.x2*t),y2:parseInt(ao.y2*al),w:parseInt(ao.w*t),h:parseInt(ao.h*al)}}function e(ao){var ap=n.getFixed();if(ap.w>B.minSelect[0]&&ap.h>B.minSelect[1]){r.enableHandles();r.done()}else{r.release()}l.setCursor(B.allowSelect?"crosshair":"default")}function Y(ap){if(B.disabled){return false}if(!B.allowSelect){return false}D=true;H=ae(X);r.disableHandles();ah("crosshair");var ao=R(ap);n.setPressed(ao);l.activateHandlers(E,e);K.watchKeys();r.update();ap.stopPropagation();ap.preventDefault();return false}function E(ao){n.setCurrent(ao);r.update()}function W(){var ao=a("<div></div>").addClass(u("tracker"));a.browser.msie&&ao.css({opacity:0,backgroundColor:"white"});return ao}function N(aD){var at=aD[0]/t,aq=aD[1]/al,az=aD[2]/t,aA=aD[3]/al;if(U){return}var ao=n.flipCoords(at,aq,az,aA);var aE=n.getFixed();var ax=initcr=[aE.x,aE.y,aE.x2,aE.y2];var au=B.animationDelay;var aG=ax[0];var ap=ax[1];var az=ax[2];var aA=ax[3];var ar=ao[0]-initcr[0];var ay=ao[1]-initcr[1];var aB=ao[2]-initcr[2];var aF=ao[3]-initcr[3];var aH=0;var aw=B.swingSpeed;r.animMode(true);var aC=function(){return function(){aH+=(100-aH)/aw;ax[0]=aG+((aH/100)*ar);ax[1]=ap+((aH/100)*ay);ax[2]=az+((aH/100)*aB);ax[3]=aA+((aH/100)*aF);if(aH<100){av()}else{r.done()}if(aH>=99.8){aH=100}y(ax)}}();function av(){window.setTimeout(aC,au)}av()}function c(ao){y([ao[0]/t,ao[1]/al,ao[2]/t,ao[3]/al])}function y(ao){n.setPressed([ao[0],ao[1]]);n.setCurrent([ao[2],ao[3]]);r.update()}function J(ao){if(typeof(ao)!="object"){ao={}}B=a.extend(B,ao);if(typeof(B.onChange)!=="function"){B.onChange=function(){}}if(typeof(B.onSelect)!=="function"){B.onSelect=function(){}}}function z(){return ak(n.getFixed())}function g(){return n.getFixed()}function P(ao){J(ao);v()}function Z(){B.disabled=true;r.disableHandles();r.setCursor("default");l.setCursor("default")}function Q(){B.disabled=false;v()}function m(){r.done();l.activateHandlers(null,null)}function T(){O.remove();ad.show()}function v(ao){B.allowResize?ao?r.enableOnly():r.enableHandles():r.disableHandles();l.setCursor(B.allowSelect?"crosshair":"default");r.setCursor(B.allowMove?"move":"default");O.css("backgroundColor",B.bgColor);if("setSelect" in B){c(s.setSelect);r.done();delete (B.setSelect)}if("trueSize" in B){t=B.trueSize[0]/an;al=B.trueSize[1]/x}am=B.maxSize[0]||0;M=B.maxSize[1]||0;aa=B.minSize[0]||0;ab=B.minSize[1]||0;if("outerImage" in B){X.attr("src",B.outerImage);delete (B.outerImage)}r.refresh()}ai.hide();v(true);var f={animateTo:N,setSelect:c,setOptions:P,tellSelect:z,tellScaled:g,disable:Z,enable:Q,cancel:m,focus:K.watchKeys,getBounds:function(){return[an*t,x*al]},getWidgetSize:function(){return[an,x]},release:r.release,destroy:T};ad.data("Jcrop",f);return f};a.fn.Jcrop=function(c){function b(f){var e=c.useImg||f.src;var d=new Image();d.onload=function(){a.Jcrop(f,c)};d.src=e}if(typeof(c)!=="object"){c={}}this.each(function(){if(a(this).data("Jcrop")){if(c=="api"){return a(this).data("Jcrop")}else{a(this).data("Jcrop").setOptions(c)}}else{b(this)}});return this}})(jQuery);/*
* One Click Upload - jQuery Plugin
* Copyright (c) 2008 Michael Mitchell - http://www.michaelmitchell.co.nz
*/
(function(a){a.fn.upload=function(b){b=a.extend({name:"file",enctype:"multipart/form-data",action:"",autoSubmit:true,onSubmit:function(){},onComplete:function(){},onSelect:function(){},params:{}},b);return new a.ocupload(this,b)},a.ocupload=function(b,c){var d=this;var g=new Date().getTime().toString().substr(8);var h=a('<iframe id="iframe'+g+'" name="iframe'+g+'"></iframe>').css({display:"none"});var e=a('<form method="post" enctype="'+c.enctype+'" action="'+c.action+'" target="iframe'+g+'"></form>').css({margin:0,padding:0});var f=a("<input />").css({position:"absolute",marginLeft:-175+"px",opacity:0}).attr("name",c.name).attr("type","file");f.css("cursor","pointer");b.wrap("<div></div>");e.append(f);b.after(e);b.after(h);var i=b.parent().css({position:"relative",cursor:"pointer",margin:0,padding:0});i.bind({mouseenter:function(){a("#import_big_button").addClass("button_hover")},mouseleave:function(){a("#import_big_button").removeClass("button_hover")}});f.css("margin-top",-i.height()-10+"px");i.mousemove(function(j){f.css({top:j.pageY-i.offset().top+"px",left:j.pageX-i.offset().left+"px"})});f.change(function(){d.onSelect();if(d.autoSubmit){d.submit()}});a.extend(this,{autoSubmit:true,onSubmit:c.onSubmit,onComplete:c.onComplete,onSelect:c.onSelect,filename:function(){return f.attr("value")},params:function(j){var j=j?j:false;if(j){c.params=a.extend(c.params,j)}else{return c.params}},name:function(j){var j=j?j:false;if(j){f.attr("name",value)}else{return f.attr("name")}},action:function(j){var j=j?j:false;if(j){e.attr("action",j)}else{return e.attr("action")}},enctype:function(j){var j=j?j:false;if(j){e.attr("enctype",j)}else{return e.attr("enctype")}},set:function(l,j){var j=j?j:false;function k(m,n){switch(m){default:throw new Error("[jQuery.ocupload.set] '"+m+"' is an invalid option.");break;case"name":d.name(n);break;case"action":d.action(n);break;case"enctype":d.enctype(n);break;case"params":d.params(n);break;case"autoSubmit":d.autoSubmit=n;break;case"onSubmit":d.onSubmit=n;break;case"onComplete":d.onComplete=n;break;case"onSelect":d.onSelect=n;break}}if(j){k(l,j)}else{a.each(l,function(m,n){k(m,n)})}},submit:function(){this.onSubmit();a.each(c.params,function(j,k){a("#ocu"+j).remove();e.append(a('<input id="ocu'+j+'" type="hidden" name="'+j+'" value="'+k+'" />'))});e.submit();h.unbind().load(function(){var k=document.getElementById(h.attr("name"));var j=a(k.contentWindow.document.body).text();e[0].reset();d.onComplete(j)})}})}})(jQuery);/* brushSelector.js*/
var brushSelector={options:{brushCanvasID:"brushCanvas"},_currentColor:{Red:255,Green:0,Blue:0,Alpha:255},create:function(){var a=this;this._MAX_SIZE=13;this._brushes=[[0],[1,0],[2,1,0],[2,1,0,0],[3,2,1,0,0],[4,2,1,1,0,0]];this._brushSize=1;this._currentTool="Brush";this._hardness=0;this.canvasBrush=$("<canvas></canvas>");this.canvasBrush.attr("width",this._MAX_SIZE);this.canvasBrush.attr("height",this._MAX_SIZE);this.canvasBrush.attr("id",this.options.brushCanvasID);this._context=this.canvasBrush[0].getContext("2d");this._updateBrush()},destroy:function(){this.element.next().remove()},_setOption:function(b,a){$.Widget.prototype._setOption.apply(this,arguments)},color:function(a){if(arguments.length){this._currentColor=a;this._updateBrush()}return this._currentColor},brushSize:function(a){if(arguments.length){this._brushSize=a;this._updateBrush()}return this._brushSize},hardness:function(a){if(arguments.length){this._hardness=a;this._updateBrush()}return this._hardness},tool:function(a){if(arguments.length){this._currentTool=a;this._updateBrush()}return this._currentTool},_getCurrentColorString:function(){return"rgba("+this._currentColor.Red+","+this._currentColor.Green+","+this._currentColor.Blue+","+this._currentColor.Alpha/255+")"},_updateBrush:function(){this.canvasBrush.attr("width",this._MAX_SIZE);if(this._brushSize==1){var d=this._context.getImageData(0,0,this._MAX_SIZE,this._MAX_SIZE);this._setCell(d,0,0);this._context.putImageData(d,0,0)}else{switch(this._currentTool){case"Brush":var b=this._brushSize/2;if(this._hardness<10){var a=this._context.createRadialGradient(b,b,(b*(this._hardness/10)),b,b,b);a.addColorStop(0,this._getCurrentColorString());a.addColorStop(1,"rgba("+this._currentColor.Red+","+this._currentColor.Green+","+this._currentColor.Blue+",0)");this._context.fillStyle=a}else{this._context.fillStyle=this._getCurrentColorString()}this._context.beginPath();this._context.arc(b,b,b,0,Math.PI*2,true);this._context.closePath();this._context.fill();iconCanvas.setBrushMatrix();break;case"Pencil":var d=this._context.getImageData(0,0,this._MAX_SIZE,this._MAX_SIZE);var f=((this._brushSize-1)/2)-1;var e=this._brushes[f];var c=(e.length*2)+1;for(row=0;row<c;row++){if(row<e.length){this._setRow(d,e[row],c-e[row],row)}else{if(row==e.length){this._setRow(d,0,c,row)}else{this._setRow(d,e[c-1-row],c-e[c-1-row],row)}}}this._context.putImageData(d,0,0);break}}},_setCell:function(b,c,d){var a=((d*this._MAX_SIZE)+c)*4;b.data[a]=this._currentColor.Red;b.data[a+1]=this._currentColor.Green;b.data[a+2]=this._currentColor.Blue;b.data[a+3]=this._currentColor.Alpha},_setRow:function(c,b,d,e){for(var a=b;a<d;a++){this._setCell(c,a,e)}}};/* ui.colorSelector*/
(function(a){a.widget("ui.colorSelector",{options:{},_currentColor:{Red:255,Green:0,Blue:0,Alpha:255},_create:function(){var e=this;var g=["red","green","blue","alpha"];var k=["Red","Green","Blue","Alpha"];var f=[255,240,60,255];this._initialColors=[[255,0,0],[0,255,0],[0,0,255],[255,255,0],[255,255,255],[0,255,255],[255,0,255],[150,150,150],[100,100,100],[0,0,0]];this._backgroundSize=4;this._backgroundColor="#AAAAAA";this._backgroundAltColor="#FFFFFF";this._sliders=new Array();this._presetColors=new Array();this._textboxs=new Array();this._onInit=true;this._mainCanvasHeight=34;this._mainCanvasWidth=34;this._presetCanvasHeight=14;this._presetCanvasWidth=14;for(var c=0;c<4;c++){a("<div class='property property_name'>"+k[c]+"</div>").appendTo(this.element);this._textboxs[c]=a("<span id='amount_"+g[c]+"' class='property property_value'></span>").appendTo(this.element);this._sliders[c]=a("<div></div>");this._sliders[c].attr("id",g[c]);this._sliders[c].appendTo(this.element);this._sliders[c].slider({orientation:"horizontal",range:"min",max:255,value:0,slide:function(n,m){e._valueChangedBySlide(n,m,a(this).attr("id"))},change:function(n,m){e._valueChangedByExternal(n,m,a(this).attr("id"))}})}this._onInit=false;a("<div class='clear'></div>").appendTo(this.element);var d=a("<div class='color_box_container'>").appendTo(this.element);for(var c=0;c<10;c++){var h=a("<a class='color_box' href='#'></a>").appendTo(d);if(c==0){h.addClass("current")}this._presetColors[c]=new Object();this._presetColors[c].canvas=a("<canvas></canvas>");this._presetColors[c].canvas.attr("width",this._presetCanvasHeight);this._presetColors[c].canvas.attr("height",this._presetCanvasWidth);this._presetColors[c].canvas.attr("data-index",c);this._presetColors[c].canvas.appendTo(h);var l={Red:this._initialColors[c][0],Green:this._initialColors[c][1],Blue:this._initialColors[c][2],Alpha:255};this._presetColors[c].color=l;this._presetColors[c].context=this._presetColors[c].canvas[0].getContext("2d");this._drawRectangle(this._presetColors[c].context,0,0,this._presetCanvasHeight,this._presetCanvasWidth,"rgba("+l.Red+","+l.Green+","+l.Blue+",1)");this._presetColors[c].canvas.click(function(m){e._changePresetColor(this,m);m.preventDefault()})}a("<div class='clear'></div>").appendTo(d);this._currentPresetIndex=0;var b=a("<div id='swatch' class='ui-widget-content ui-corner-all'></div>").appendTo(this.element);this._currentColorCanvas=a("<canvas></canvas>");this._currentColorCanvas.attr("width",this._mainCanvasHeight);this._currentColorCanvas.attr("height",this._mainCanvasWidth);this._currentColorCanvas.appendTo(b);a("<div class='clear'></div>").appendTo(this.element);a(".color_box").click(function(m){m.preventDefault();a(".color_box").removeClass("current");a(a(this)).addClass("current")});this._setPresetColor(this._currentPresetIndex)},_setPresetColor:function(b){this._currentPresetIndex=b;this._currentPresetColorCanvas=this._presetColors[b].canvas;this._currentPresetColorContext=this._presetColors[b].context;this._currentPresetColorColor=this._presetColors[b].color;this._currentColor=this._currentPresetColorColor;this._setColor();this._trigger("onColorChange")},_changePresetColor:function(b,c){this._setPresetColor(parseInt(a(b).attr("data-index")))},_drawRectangle:function(f,c,d,e,b,g){f.fillStyle=g;f.fillRect(c,d,e,b)},_drawBackGround:function(b,c,d){this._drawRectangle(b,0,0,d,c,this._backgroundColor);if(this._backgroundSize>0){var e=true;var f=d/this._backgroundSize;for(i=0;i<f;i++){for((i%2==0)?j=0:j=1;j<f;j+=2){this._drawRectangle(b,j*this._backgroundSize,i*this._backgroundSize,this._backgroundSize,this._backgroundSize,this._backgroundAltColor);if(j!=f-1){e=!e}}}}},_getColorString:function(){return"rgba("+this._currentColor.Red+","+this._currentColor.Green+","+this._currentColor.Blue+","+this._currentColor.Alpha/255+")"},color:function(b){if(arguments.length){this._currentColor=b;this._setColor()}return this._currentColor},_setColor:function(){this._sliders[0].slider("value",this._currentColor.Red);this._sliders[1].slider("value",this._currentColor.Green);this._sliders[2].slider("value",this._currentColor.Blue);this._sliders[3].slider("value",this._currentColor.Alpha);this._textboxs[0].val(this._currentColor.Red);this._textboxs[1].val(this._currentColor.Green);this._textboxs[2].val(this._currentColor.Blue);this._textboxs[3].val(this._currentColor.Alph);this._refeshCurrentColorCanvas()},_refreshMainColorCanvas:function(b,c,d){if(this._currentColor.Alpha<255){this._drawBackGround(b,c,d)}this._drawRectangle(b,0,0,d,c,this._getColorString());b.clearRect(0,0,2,1);b.clearRect(0,c-1,1,1);b.clearRect(d-1,0,1,1);b.clearRect(d-1,c-1,1,1)},_refreshColorCanvas:function(b,c,d){if(this._currentColor.Alpha<255){this._drawBackGround(b,c,d)}this._drawRectangle(b,0,0,d,c,this._getColorString())},_refeshCurrentColorCanvas:function(){var b=this._currentColorCanvas[0].getContext("2d");this._refreshMainColorCanvas(b,this._mainCanvasHeight,this._mainCanvasWidth);this._refreshColorCanvas(this._currentPresetColorContext,this._presetCanvasHeight,this._presetCanvasWidth)},_valueChangedByExternal:function(c,b,d){if(!this._onInit){a("#amount_"+d).html(b.value)}},_valueChangedBySlide:function(c,b,d){if(!this._onInit){a("#amount_"+d).html(b.value);switch(d){case"red":this._currentColor.Red=b.value;break;case"green":this._currentColor.Green=b.value;break;case"blue":this._currentColor.Blue=b.value;break;case"alpha":this._currentColor.Alpha=b.value;break}this._presetColors[this._currentPresetIndex].color=this._currentColor;this._refeshCurrentColorCanvas();this._trigger("onColorChange")}},_setOption:function(c,b){a.Widget.prototype._setOption.apply(this,arguments)},destroy:function(){}})}(jQuery));/* iconCanvas.js*/
var iconCanvas={options:{canvasWidth:384,canvasHeight:384,drawingAreaWidth:384,drawingAreaHeight:384,canvasIDprefix:"canvas",previewCanvasTargets:["prevCanvas64","prevCanvas32","prevCanvas24","prevCanvas16"],brushCanvasID:"brushCanvas",brushImgID:"brushImg",textBoxID:"textBox",undoID:"undocnt",redoID:"redocnt",getSmallID:"getSmall",getBigID:"getBig",getSmall_labelID:"getSmall_label",getBig_labelID:"getBig_label"},oldPosition:{x:0,y:0},currentPosition:{x:0,y:0},firstPosition:{x:0,y:0},_currentColor:{Red:255,Green:0,Blue:0,Alpha:255},create:function(e){base=this;var d=this;this.element=$("#"+e);this.backgroundSize=60;this.backgroundColor="#ffffff";this.backgroundAltColor="#cccccc";this._resolutions=[{height:64,width:64},{height:32,width:32},{height:24,width:24},{height:16,width:16}];this._previewCanvasArray=new Array();this._histories=new Array();this._brushMatrix=new Array();this._gridLinesColor="rgba(255,255,255,.8)";this._brushPreviewColor="rgba(0,0,0,.5)";this._undoControl=$("#"+this.options.undoID);this._redoControl=$("#"+this.options.redoID);this._undoControl.addClass("disabled");this._redoControl.addClass("disabled");this._brushes=[[0],[1,0],[2,1,0],[2,1,0,0],[3,2,1,0,0],[4,2,1,1,0,0],[5,3,2,1,1,0,0]];this._gridLinesWidth=1;this._brushSize=1;this._halfSizeBrush=0;this._startLine=false;this._originalImage=null;this._drawing=false;this._currentTool="Brush";this._currentResolution=0;this._tolerance=0;this._fontSize=8;this._fontFamily="Arial";this._textBox=$("#"+this.options.textBoxID);this._gridShow=true;this._showInvalidationRegions=false;this._backCanvas=this._initCanvas("back_"+this.options.canvasIDprefix,"1");this._backContext=this._backCanvas[0].getContext("2d");this._canvas=this._initCanvas(this.options.canvasIDprefix,"2");this._context=this._canvas[0].getContext("2d");this._toolCanvas=this._initCanvas("tool_"+this.options.canvasIDprefix,"3");this._toolContext=this._toolCanvas[0].getContext("2d");this._gridCanvas=this._initCanvas("grid_"+this.options.canvasIDprefix,"4");this._gridContext=this._gridCanvas[0].getContext("2d");for(var g=0;g<this._resolutions.length;g++){var f=$("<canvas></canvas>");var a=this._resolutions[g].height;var k=this._resolutions[g].width;f.attr("width",k).attr("height",a);f.attr("id","previewCanvas_"+k+"x"+a);f.appendTo($("#"+this.options.previewCanvasTargets[g]));var b=f[0].getContext("2d");this._previewCanvasArray[g]={canvas:f,context:b};this._histories[g]=new Array();this._histories[g]["memory"]=new Array();this._histories[g]["currentPosition"]=0;this._histories[g]["maxRedo"]=0;this._histories[g]["canRedo"]=false;this._histories[g]["canUndo"]=false;this._histories[g]["changed"]=false}this._gridCanvas.bind({mousemove:this._mouseMove,mousedown:function(c){d.oldPosition.x=Math.floor((c.pageX-this.offsetLeft)/d._stepsHorizontal);d.oldPosition.y=Math.floor((c.pageY-this.offsetTop)/d._stepsVertical);d._mouseDown(c)},mouseup:function(c){d._mouseUp(c)},mouseenter:function(c){d.element.css("cursor","crosshair")},mouseleave:function(c){d._toolCanvas.attr("width",d.options.canvasWidth);d.element.css("cursor","default");d._drawing=false}});for(var g=0;g<this._previewCanvasArray.length;g++){this._previewCanvasArray[g].canvas.parent().bind({mousedown:function(c){d._currentResolution=parseInt($(this).attr("data-index"));d._changeCanvas()}})}this._smallButton=$("#"+this.options.getSmallID);this._bigButton=$("#"+this.options.getBigID);this._smallButtonLabel=$("#"+this.options.getSmall_labelID);this._bigButtonLabel=$("#"+this.options.getBig_labelID);this._smallButton.click(function(c){d._getFromSmall(c)});this._bigButton.click(function(c){d._getFromBig(c)});this._changeCanvas();this._drawBackGround();this._drawGrid()},_resizeImage:function(k,h){$("#waiting_box").dialog("open");var g=this.getImageArray(h);var d=this._resolutions[h].width;var e=this._resolutions[h].height;var f=this._resolutions[k].width;var a=this._resolutions[k].height;var b="{'data':'"+g+"','inWidth':'"+d+"','inHeight':'"+e+"','outWidth':'"+f+"','outHeight':'"+a+"'}";var c=this;$.ajax({type:"POST",url:"ImagesWebService.asmx/ResizeIcon",data:b,contentType:"application/json; charset=utf-8",dataType:"json",success:function(l){c._resizeSucceeded(l)},error:function(l){c._resizeFaild(l)}})},_getFromBig:function(a){a.preventDefault();this._resizeImage(this._currentResolution,this._currentResolution-1)},_resizeSucceeded:function(a){this.setImageArray(this._currentResolution,a.d);$("#waiting_box").dialog("close")},_resizeFaild:function(a){$("#waiting_box").dialog("close")},_getFromSmall:function(a){a.preventDefault();this._resizeImage(this._currentResolution,this._currentResolution+1)},_initCanvas:function(b,a){var c=$("<canvas></canvas>");c.attr("width",this.options.canvasWidth);c.attr("height",this.options.canvasHeight);c.attr("id",b);c.css("position","absolute");c.css("top","0");c.css("left","0");c.css("z-index",a);c.appendTo(this.element);return c},_changeCanvas:function(){for(var a=0;a<this._previewCanvasArray.length;a++){this._previewCanvasArray[a].canvas.parent().parent().removeClass("current")}this._previewCanvasArray[this._currentResolution].canvas.parent().parent().addClass("current");this._horizontalPixels=this._resolutions[this._currentResolution].width;this._verticalPixels=this._resolutions[this._currentResolution].height;this._stepsHorizontal=this.options.drawingAreaWidth/this._horizontalPixels;this._stepsVertical=this.options.drawingAreaHeight/this._verticalPixels;this._history=this._histories[this._currentResolution];this._undoControl.addClass("disabled");if(this._history.canRedo){this._redoControl.removeClass("disabled")}else{this._redoControl.addClass("disabled")}if(this._history.canUndo){this._undoControl.removeClass("disabled")}else{this._undoControl.addClass("disabled")}this._previewContext=this._previewCanvasArray[this._currentResolution].context;this._replicate(0,0,this._horizontalPixels,this._verticalPixels);this._drawGrid();this._bigButton.css("display",this._currentResolution==0?"none":"");this._smallButton.css("display",this._currentResolution==3?"none":"");if(this._currentResolution>0){this._bigButtonLabel.html("Get from "+this._resolutions[this._currentResolution-1].height+"x"+this._resolutions[this._currentResolution-1].width)}if(this._currentResolution<3){this._smallButtonLabel.html("Get from "+this._resolutions[this._currentResolution+1].height+"x"+this._resolutions[this._currentResolution+1].width)}},destroy:function(){this.element.next().remove()},_getCurrentColorString:function(){var b=this._currentColor.Alpha;var a=b==255?1:Math.round(b/255*1000)/1000;return"rgba("+this._currentColor.Red+","+this._currentColor.Green+","+this._currentColor.Blue+","+a+")"},setBackgroundColors:function(a,b){this.backgroundColor=a;this.backgroundAltColor=b;this._drawBackGround()},setGridSize:function(a){this.backgroundSize=a;this._drawBackGround()},clear:function(){this._storeHistory();this._history.changed=false;this._canvas.attr("width",this.options.canvasWidth);this._previewCanvasArray[this._currentResolution].canvas.attr("width",this._horizontalPixels)},setBrushMatrix:function(){this._brushMatrix=new Array();var d=brushSelector.canvasBrush[0].getContext("2d");var b=d.getImageData(0,0,this._brushSize,this._brushSize);var c=b.data;var f=c.length;for(var a=0;a<f;a+=4){var e=c[a+3];if(c[a+3]>0){var g=e==255?1:Math.round(e/255*1000)/1000;this._brushMatrix[a/4]="rgba("+c[a]+","+c[a+1]+","+c[a+2]+","+g+")"}else{this._brushMatrix[a/4]=""}}},tolerance:function(a){if(arguments.length){this._tolerance=a==0?0:a/100*510}return this._tolerance},fontSize:function(a){if(arguments.length){this._fontSize=a}return this._fontSize},fontFamily:function(a){if(arguments.length){this._fontFamily=a}return this._fontFamily},brushSize:function(a){if(arguments.length){this._brushSize=a;this._halfSizeBrush=Math.floor(this._brushSize/2)}return this._brushSize},tool:function(a){if(arguments.length){this._currentTool=a}return this._currentTool},color:function(a){if(arguments.length){this._currentColor=a}return this._currentColor},_drawLine:function(b,e,d,f,c,g,a){b.beginPath();b.moveTo(e,d);b.lineWidth=a;b.strokeStyle=g;b.lineTo(f,c);b.closePath();b.stroke()},_paintText:function(){var b=this.currentPosition.x;var c=this.currentPosition.y;this._previewContext.textBaseline="top";this._previewContext.fillStyle=this._getCurrentColorString();this._previewContext.font=this._getCurrentFontString(1);var a=this._previewContext.measureText(this._textBox.val());this._previewContext.fillText(this._textBox.val(),b,c);this._replicate(b,c,Math.floor(a.width*1.2),Math.floor(this._fontSize*1.2));this._toolCanvas.attr("width",this.options.canvasWidth);this._textBox.val("")},_paintCircle:function(){var c=this._previewContext;c.save();c.lineCap="butt";c.lineWidth=this._brushSize;c.strokeStyle=this._getCurrentColorString();var a=Math.abs(this.currentPosition.x-this.firstPosition.x);var b=Math.abs(this.currentPosition.y-this.firstPosition.y);var d;c.save();c.translate((this.firstPosition.x+0.5),(this.firstPosition.y+0.5));if(a<b){c.scale(a/b,1);d=b}else{c.scale(1,b/a);d=a}c.beginPath();c.arc(0,0,d,0,Math.PI*2,false);c.restore();c.stroke();c.restore();this._replicate(this.firstPosition.x-d-this._brushSize,this.firstPosition.y-d-this._brushSize,(d+this._brushSize)*2,(d+this._brushSize)*2)},_paintPencil:function(b,c,k){var o=this._brushSize;var m=this._previewContext;var d=this._context;var n=this._stepsHorizontal;m.fillStyle=k;d.fillStyle=k;if(o==1){m.fillRect(b,c,1,1);d.fillRect(b*n,c*n,n,n)}else{var h=((o-1)/2)-1;var f=this._brushes[h];var e=(f.length*2)+1;var l=b-this._halfSizeBrush;var a=c-this._halfSizeBrush;for(row=0;row<e;row++){if(row<f.length){m.fillRect(l+f[row],a+row,e-(f[row]*2),1);d.fillRect((l+f[row])*n,(a+row)*n,(e-(f[row]*2))*n,n)}else{if(row==f.length){m.fillRect(l,a+row,e,1);d.fillRect(l*n,(a+row)*n,e*n,n)}else{m.fillRect(l+f[e-1-row],a+row,e-(f[e-1-row]*2),1);d.fillRect((l+f[e-1-row])*n,(a+row)*n,(e-(f[e-1-row]*2))*n,n)}}}}},_paintEraser:function(b,c){var n=this._brushSize;var l=this._previewContext;var d=this._context;var m=this._stepsHorizontal;if(n==1){l.clearRect(b,c,1,1);d.clearRect(b*m,c*m,m,m)}else{var h=((n-1)/2)-1;var f=this._brushes[h];var e=(f.length*2)+1;var k=b-this._halfSizeBrush;var a=c-this._halfSizeBrush;for(row=0;row<e;row++){if(row<f.length){l.clearRect(k+f[row],a+row,e-(f[row]*2),1);d.clearRect((k+f[row])*m,(a+row)*m,(e-(f[row]*2))*m,m)}else{if(row==f.length){l.clearRect(k,a+row,e,1);d.clearRect(k*m,(a+row)*m,e*m,m)}else{l.clearRect(k+f[e-1-row],a+row,e-(f[e-1-row]*2),1);d.clearRect((k+f[e-1-row])*m,(a+row)*m,(e-(f[e-1-row]*2))*m,m)}}}}},_getCurrentFontString:function(a){return this._fontSize*a+"px "+this._fontFamily},_mouseMove:function(s){var E=iconCanvas;E.oldPosition.x=E.currentPosition.x;E.oldPosition.y=E.currentPosition.y;var G=$("#"+E.options.canvasIDprefix).offset();E.currentPosition.x=0|((s.pageX-G.left)/E._stepsHorizontal);E.currentPosition.y=0|((s.pageY-G.top)/E._stepsVertical);if(E.oldPosition.x==E.currentPosition.x&&E.oldPosition.y==E.currentPosition.y){return}var k=E.currentPosition.x;var B=E.currentPosition.y;var e=E.oldPosition.x;var z=E.oldPosition.y;var t=E._stepsHorizontal;var l=E._brushSize;switch(E._currentTool){case"Text":E._toolCanvas.attr("width",E.options.canvasWidth);var C=E._toolContext;C.textBaseline="top";C.fillStyle=E._getCurrentColorString();C.font=E._getCurrentFontString(t);C.fillText(E._textBox.val(),(E.currentPosition.x)*t,(E.currentPosition.y)*t);break;case"Circle":if(E._startLine){E._toolCanvas.attr("width",E.options.canvasWidth);var C=E._toolContext;C.save();C.lineCap="butt";C.lineWidth=E._brushSize*t;C.strokeStyle=E._getCurrentColorString();var v=Math.abs(E.currentPosition.x-E.firstPosition.x);var y=Math.abs(E.currentPosition.y-E.firstPosition.y);var f;C.save();C.translate((E.firstPosition.x+0.5)*t,(E.firstPosition.y+0.5)*t);if(v<y){C.scale(v/y,1);f=y}else{C.scale(1,y/v);f=v}C.beginPath();C.arc(0,0,f*t,0,Math.PI*2,false);C.restore();C.stroke();C.restore()}break;case"Rectangle":if(E._startLine){E._toolCanvas.attr("width",E.options.canvasWidth);var C=E._toolContext;var o=E._getRectangle();C.lineCap="butt";C.lineWidth=E._brushSize*t;C.strokeStyle=E._getCurrentColorString();C.strokeRect((o.x+0.5)*t,(o.y+0.5)*t,(o.width)*t,(o.height)*t)}break;case"Brush":if(E._drawing){var n=E._getCurrentColorString();var p=Math.abs(k-e);var q=Math.abs(B-z);if(p>1||q>1){var c=E._getPointLine(k,e,B,z);for(var a=0;a<c.length;a++){E._paintBrush(c[a][0],c[a][1],n)}}else{E._paintBrush(k,B,n)}}break;case"Pencil":if(E._drawing){var n=E._getCurrentColorString();var p=Math.abs(k-e);var q=Math.abs(B-z);if(p>1||q>1){var c=E._getPointLine(k,e,B,z);for(var a=0;a<c.length;a++){E._paintPencil(c[a][0],c[a][1],n)}}else{E._paintPencil(k,B,n)}}break;case"Line":if(E._startLine){E._toolCanvas.attr("width",E.options.canvasWidth);var C=E._toolContext;C.lineCap="butt";C.beginPath();C.moveTo((E.firstPosition.x+0.5)*t,(E.firstPosition.y+0.5)*t);C.lineWidth=E._brushSize*t;C.strokeStyle=E._getCurrentColorString();C.lineTo((E.currentPosition.x+0.5)*t,(E.currentPosition.y+0.5)*t);C.closePath();C.stroke()}break;case"Eraser":E._toolCanvas.attr("width",E.options.canvasWidth);if(E._drawing){if(Math.abs(k-e)>1||Math.abs(B-z)>1){var D=E._getPointLine(k,e,B,z);for(var a=0;a<D.length;a++){E._paintEraser(D[a][0],D[a][1])}}else{E._paintEraser(k,B)}}else{var b=E.currentPosition.x;var m=E.currentPosition.y;var C=E._toolContext;var l=E._brushSize;C.fillStyle=E._brushPreviewColor;if(l==1){C.fillRect(b*E._stepsHorizontal,m*E._stepsVertical,E._stepsHorizontal,E._stepsVertical)}else{var r=((l-1)/2)-1;var u=E._brushes[r];var x=(u.length*2)+1;var A=b-E._halfSizeBrush;var F=m-E._halfSizeBrush;for(row=0;row<x;row++){var d=(F+row)*E._stepsVertical;if(row<u.length){C.fillRect((A+u[row])*E._stepsHorizontal,d,(x-(u[row]*2))*E._stepsHorizontal,E._stepsVertical)}else{if(row==u.length){C.fillRect((A)*E._stepsHorizontal,d,x*E._stepsHorizontal,E._stepsVertical)}else{C.fillRect((A+u[x-1-row])*E._stepsHorizontal,d,(x-(u[x-1-row]*2))*E._stepsHorizontal,E._stepsVertical)}}}}}break}},_previewEraserRow:function(a,c,d,e){for(var b=c;b<d;b++){this._setCell(imageData,b,e)}},_mouseDown:function(d){var a=(d.button==0);switch(this._currentTool){case"Text":if(a){this._storeHistory();this._paintText()}break;case"Fill":if(a){this._storeHistory();this._floodFillScanlineStack()}break;case"Circle":if(a){this._startLine=true;this.firstPosition.x=this.currentPosition.x;this.firstPosition.y=this.currentPosition.y}break;case"Rectangle":if(a){this._startLine=true;this.firstPosition.x=this.currentPosition.x;this.firstPosition.y=this.currentPosition.y}break;case"Eraser":this._startLine=false;if(a){this._storeHistory();this._drawing=true;this._paintEraser(this.currentPosition.x,this.currentPosition.y)}break;case"Brush":var b=iconCanvas._getCurrentColorString();this._startLine=false;if(a){this._storeHistory();this._drawing=true;this._paintBrush(this.currentPosition.x,this.currentPosition.y,b)}break;case"Pencil":var b=iconCanvas._getCurrentColorString();this._startLine=false;if(a){this._storeHistory();this._drawing=true;this._paintPencil(this.currentPosition.x,this.currentPosition.y,b)}break;case"Line":if(a){this._startLine=true;this.firstPosition.x=this.currentPosition.x;this.firstPosition.y=this.currentPosition.y}else{this._toolCanvas.attr("width",this.options.canvasWidth);this._startLine=false}break;case"Eyedropper":this._startLine=false;if(a){var c=this._previewContext.getImageData(this.currentPosition.x,this.currentPosition.y,1,1);this._currentColor.Red=c.data[0];this._currentColor.Green=c.data[1];this._currentColor.Blue=c.data[2];this._currentColor.Alpha=c.data[3];this.element.trigger("onEyedropper")}break}},_mouseUp:function(b){this._toolCanvas.attr("width",this.options.canvasWidth);switch(this._currentTool){case"Brush":case"Pencil":this._drawing=false;break;case"Eraser":this._drawing=false;break;case"Rectangle":if(this._startLine){this._storeHistory();var a=this._getRectangle();this._paintRectangle(a.x,a.y,a.width,a.height,this._brushSize);this._startLine=false}case"Line":if(this._startLine){this._storeHistory();this._paintLine(this.firstPosition.x,this.firstPosition.y,this.currentPosition.x,this.currentPosition.y,this._brushSize);this._startLine=false}break;case"Circle":if(this._startLine){this._storeHistory();this._paintCircle();this._startLine=false}break}},_redoHistory:function(){if(this._history.canRedo){this._history.canUndo=true;this._undoControl.removeClass("disabled");this._history.currentPosition++;this._history.canRedo=this._history.currentPosition<this._history.maxRedo;if(this._history.canRedo){this._redoControl.removeClass("disabled")}else{this._redoControl.addClass("disabled")}this._previewContext.putImageData(this._history.memory[this._history.currentPosition],0,0);this._replicate(0,0,this._horizontalPixels,this._verticalPixels)}},_restoreHistory:function(){if(this._history.canUndo){if(this._history.currentPosition==this._history.maxRedo){this._history.memory[this._history.currentPosition]=this._previewContext.getImageData(0,0,this._horizontalPixels,this._verticalPixels)}this._history.canRedo=true;this._redoControl.removeClass("disabled");this._history.currentPosition--;this._history.canUndo=this._history.currentPosition>0;if(this._history.canUndo){this._undoControl.removeClass("disabled")}else{this._undoControl.addClass("disabled")}this._previewContext.putImageData(this._history.memory[this._history.currentPosition],0,0);this._replicate(0,0,this._horizontalPixels,this._verticalPixels)}},_storeHistory:function(){this._history.memory[this._history.currentPosition]=this._previewContext.getImageData(0,0,this._horizontalPixels,this._verticalPixels);this._history.currentPosition++;this._history.maxRedo=this._history.currentPosition;this._history.canRedo=false;this._history.canUndo=true;this._history.changed=true;this._undoControl.removeClass("disabled");this._redoControl.addClass("disabled")},_drawGrid:function(){if(this._gridShow){this._gridCanvas.attr("width",this.options.canvasWidth);this._drawVerticalLines();this._drawHoriziontalLines()}},undo:function(){this._restoreHistory()},redo:function(){this._redoHistory()},setImageArray:function(k,c){var h=this._histories[k];var b=this._resolutions[k].width;var g=this._resolutions[k].height;var f=this._previewCanvasArray[k].context;h.memory[h.currentPosition]=f.getImageData(0,0,b,g);h.currentPosition++;h.maxRedo=h.currentPosition;h.canRedo=false;h.canUndo=true;h.changed=true;var d=this._previewCanvasArray[k].context.getImageData(0,0,this._resolutions[k].width,this._resolutions[k].height);var l=d.data.length;var e=c.split(",");for(var a=0;a<l;a++){d.data[a]=parseInt(e[a])}this._previewCanvasArray[k].context.putImageData(d,0,0);if(k==this._currentResolution){this._changeCanvas()}},getIsChanged:function(a){return this._histories[a]["changed"]},getImageArray:function(g){var e="";var d=this._previewCanvasArray[g].context.getImageData(0,0,this._resolutions[g].width,this._resolutions[g].height);var a=d.data;var f=d.data.length;var b=true;for(var c=0;c<f;c++){e+=a[c]+";";if(b&&((c+1)%4)==0&&a[c]>0){b=false}}if(b){return""}e=e.substring(0,e.length-1);return e},_paintBrush:function(a,b,h){var m=this._brushSize;var k=this._previewContext;var c=this._context;var l=this._stepsHorizontal;if(m==1){k.fillStyle=h;c.fillStyle=h;k.fillRect(a,b,1,1);c.fillRect(a*l,b*l,l,l)}else{k.drawImage(brushSelector.canvasBrush[0],0,0,m,m,a-this._halfSizeBrush,b-this._halfSizeBrush,m,m);for(var d=0;d<this._brushMatrix.length;d++){if(this._brushMatrix[d]!=""){var e=0|(d/m);var f=d-(e*m);c.fillStyle=this._brushMatrix[d];c.fillRect((f+a-this._halfSizeBrush)*l,(e+b-this._halfSizeBrush)*l,l,l)}}}},_replicate:function(c,d,e,b){if(e>0&&b>0){var a=this._previewContext.getImageData(c,d,e,b);this._restore(a,c,d,e,b)}},_restore:function(o,a,b,p,f){var n=this._context;n.clearRect(a*this._stepsHorizontal,b*this._stepsVertical,this._stepsHorizontal*p,this._stepsVertical*f);var k=o.data;var h=o.data.length;var g=this._stepsHorizontal;var d=this._stepsVertical;for(i=0;i<h;i+=4){var e=k[i+3];if(e>0){var c=0|(i/4/p);var m=i/4-(c*p);var l=e==255?1:Math.round(e/255*1000)/1000;n.fillStyle="rgba("+k[i]+","+k[i+1]+","+k[i+2]+","+l+")";n.fillRect((m+a)*g,(c+b)*d,g,d)}}if(this._showInvalidationRegions){this._context.beginPath();this._context.rect(a*this._stepsHorizontal,b*this._stepsVertical,this._stepsHorizontal*p,this._stepsVertical*f);this._context.closePath();this._context.fillStyle="#FF0000";this._context.stroke()}},_drawPixel:function(k,a,h,g,b,c,f,d,e){f.fillStyle="rgba("+k+","+a+","+h+","+g+")";f.fillRect(b*this._stepsHorizontal,c*this._stepsVertical,this._stepsHorizontal,this._stepsVertical)},_paintRectangle:function(b,c,d,a,e){var f=this._previewContext;f.lineCap="butt";f.lineWidth=e;f.strokeStyle=this._getCurrentColorString();f.strokeRect((b+0.5),(c+0.5),d,a);this._replicate(b-e,c-e,d+e*2,a+e*2)},_paintLine:function(a,d,b,c,e){var f=this._previewContext;f.lineCap="butt";f.beginPath();f.moveTo(a+0.5,d+0.5);f.lineWidth=e;f.strokeStyle=this._getCurrentColorString();f.lineTo(b+0.5,c+0.5);f.closePath();f.stroke();this._replicateLine(a,b,d,c)},_drawHoriziontalLines:function(){for(i=1;i<this._horizontalPixels;i++){this._drawLine(this._gridContext,0.5,(i*this._stepsHorizontal)+0.5,this.options.drawingAreaWidth+0.5,(i*this._stepsHorizontal)+0.5,this._gridLinesColor,this._gridLinesWidth)}},_drawVerticalLines:function(){for(i=1;i<this._verticalPixels;i++){this._drawLine(this._gridContext,(i*this._stepsVertical)+0.5,0.5,(i*this._stepsVertical)+0.5,this.options.drawingAreaHeight+0.5,this._gridLinesColor,this._gridLinesWidth)}},_drawRectangle:function(d,e,c,b,a){this._backContext.fillStyle=a;this._backContext.fillRect(d,e,c,b)},_drawBackGround:function(){this._drawRectangle(0,0,this.options.drawingAreaWidth,this.options.drawingAreaHeight,this.backgroundColor);if(this.backgroundSize>0){var b=true;var a=this.options.drawingAreaWidth/this.backgroundSize;for(i=0;i<a;i++){for((i%2==0)?j=0:j=1;j<a;j+=2){this._drawRectangle(j*this.backgroundSize,i*this.backgroundSize,this.backgroundSize,this.backgroundSize,this.backgroundAltColor);if(j!=a-1){b=!b}}}}},_getRectangle:function(){var b=this.firstPosition.x;var c=this.currentPosition.x-b;if(this.firstPosition.x>this.currentPosition.x){b=this.currentPosition.x;c=this.firstPosition.x-b}var d=this.firstPosition.y;var a=this.currentPosition.y-d;if(this.firstPosition.y>this.currentPosition.y){d=this.currentPosition.y;a=this.firstPosition.y-d}return{x:b,y:d,width:c,height:a}},_getCircle:function(){var d=Math.abs(this.currentPosition.x-this.firstPosition.x)/2;var a=Math.abs(this.currentPosition.x-this.firstPosition.x)/2;var b=this.currentPosition.x-d;var c=this.currentPosition.y-a;if(this.currentPosition.x<this.firstPosition.x){b=this.currentPosition.x+d}if(this.currentPosition.y<this.firstPosition.y){c=this.currentPosition.y+a}return{x:b,y:c}},_getPointLine:function(n,d,o,m){var e=Math.abs(m-o)>Math.abs(d-n);if(e){var k=n;n=o;o=k;var k=d;d=m;m=k}if(n>d){var k=d;d=n;n=k;var k=m;m=o;o=k}var l=d-n;var p=Math.abs(m-o);var g=l/2;var f;var b=o;if(o<m){f=1}else{f=-1}var c=new Array();var h=0;for(var a=n;a<d;a++){if(e){c[h++]=[b,a]}else{c[h++]=[a,b]}g=g-p;if(g<0){b=b+f;g=g+l}}return c},_replicateLine:function(a,b,d,c){var g=this._getPointLine(a,b,d,c);var e=this._brushSize;if(e==1){e++}else{e--}if(g.length>0){this._replicate(g[0][0]-e,g[0][1]-e,e*2,e*2);for(var f=0;f<g.length-1;f+=2){this._replicate(g[f][0]-e,g[f][1]-e,e*2,e*2);$("displayArray").html(g[f][0],",",g[f][1])}this._replicate(g[g.length-1][0]-e,g[g.length-1][1]-e,e*2,e*2)}},_getDistance:function(l,f){var a=(l.r-f.r)==0?0:Math.pow(l.r-f.r,2);var m=(l.g-f.g)==0?0:Math.pow(l.g-f.g,2);var c=(l.b-f.b)==0?0:Math.pow(l.b-f.b,2);var e=(l.a-f.a)==0?0:Math.pow(l.a-f.a,2);return Math.sqrt(a+m+c+e);var d=(l.r+f.r)/2;var k=l.r-f.r;var n=l.g-f.g;var h=l.b-f.b;return Math.sqrt((((512+d)*k*k)>>8)+4*n*n+(((767-d)*h*h)>>8))},_stopFunction:function(a,c){if(this._tolerance==0){return c.r!=a.r||c.g!=a.g||c.b!=a.b||c.a!=a.a}else{var b=this._getDistance(a,c);if(b>0&&b>this._tolerance){return true}}return false},_floodFillScanlineStack:function(){var b=this.currentPosition.x;var c=this.currentPosition.y;var F=[this._currentColor.Red,this._currentColor.Green,this._currentColor.Blue,this._currentColor.Alpha];var v=this._previewContext.getImageData(0,0,this._horizontalPixels,this._verticalPixels);var s,u,h,k,g,C,r,w;var m=this._horizontalPixels;var l=this._verticalPixels;s=h=b;u=k=c;var q=new Array(this._horizontalPixels*this._verticalPixels);var f=b;var n=c;var E=n*this._verticalPixels+f;var B=[E];var e=v.data;var d=this._previewContext.getImageData(b,c,1,1).data;var o={r:d[0],g:d[1],b:d[2],a:d[3]};var D={r:this._currentColor.Red,g:this._currentColor.Green,b:this._currentColor.Blue,a:this._currentColor.Alpha};var z={r:0,g:0,b:0,a:1};var A=D.r;var t=D.g;var p=D.b;var a=D.a;while(B.length>0){E=B.pop();f=E%m;n=(E-f)/m;if(!q[E]){q[E]=true;w=E*4;z.r=e[w];z.g=e[w+1];z.b=e[w+2];z.a=e[w+3];if(!this._stopFunction(o,z)){e[w]=A;e[w+1]=t;e[w+2]=p;e[w+3]=a;if(f<s){s=f}else{if(f>h){h=f}}if(n<u){u=n}else{if(n>k){k=n}}g=f-1;C=n;r=C*m+g;if(g>=0&&!q[r]){B.push(r)}g=f;C=n+1;r=C*m+g;if(C<l&&!q[r]){B.push(r)}g=f+1;C=n;r=C*m+g;if(g<m&&!q[r]){B.push(r)}g=f;C=n-1;r=C*m+g;if(C>=0&&!q[r]){B.push(r)}}}}this._previewContext.putImageData(v,0,0);this._replicate(s,u,h-s+1,k-u+1)}};/* ui.toolSettings*/
(function(a){a.widget("ui.toolSettings",{options:{textBoxID:"textBox"},_create:function(){var d=this;this._sliderIDs=["diameter","hardness","tolerance","fontSize"];this._sliderLabels=["Diameter","Hardness","Tolerance","Font Size"];this._sliderRanges=[[0,6,0,"1px"],[0,10,0,"0"],[0,100,0,"0%"],[8,20,8,"8px"]];this._containers=new Array();this._sliders=new Array();this._textboxs=new Array();this._onInit=true;this._currentTool="Brush";this._visibilityArray=new Object();this._visibilityArray.Brush=[0,1];this._visibilityArray.Pencil=[0];this._visibilityArray.Circle=[0];this._visibilityArray.Rectangle=[0];this._visibilityArray.Eraser=[0];this._visibilityArray.Text=[3,4,5];this._visibilityArray.Fill=[2];this._visibilityArray.Line=[0];this._visibilityArray.Eyedropper=[];for(var c=0;c<4;c++){var b=a("<div></div>").appendTo(this.element);this._containers[c]=b;a("<div class='property property_name'>"+this._sliderLabels[c]+"</div>").appendTo(b);this._textboxs[c]=a("<span id='amount_"+this._sliderIDs[c]+"' class='property property_value' />").appendTo(b).html(this._sliderRanges[c][3]);a("<div class='clear'></div>").appendTo(b);this._sliders[c]=a("<div></div>");this._sliders[c].attr("id","slider_"+this._sliderIDs[c]);this._sliders[c].attr("class","slider_tools");this._sliders[c].attr("data-cleanID",this._sliderIDs[c]);this._sliders[c].appendTo(b);this._sliders[c].slider({orientation:"horizontal",min:this._sliderRanges[c][0],max:this._sliderRanges[c][1],value:this._sliderRanges[c][2],slide:function(h,g){d._valueChangedBySlide(h,g,a(this).attr("id"),a(this).attr("data-cleanID"))},change:function(h,g){}})}this._onInit=false;var f=[["Arial","Arial"],["Verdana","Verdana"],["Times New Roman","Times New Roman"],["Courier","Courier"]];var b=a("<div></div>").appendTo(this.element);this._containers[this._containers.length]=b;a("<div class='property property_name'>Font</div>").appendTo(b);var e=a("<select class='property text_select' id='font_select'></select>");for(var c=0;c<f.length;c++){e.append("<option value='"+f[c][0]+"'>"+f[c][1]+"</option>")}e.appendTo(b);e.change(function(g){d._trigger("onChangeFontFamily",g,a(this).val())});var b=a("<div></div>").appendTo(this.element);this._containers[this._containers.length]=b;a("<div class='property property_name'>Text</div>").appendTo(b);this._tb=a("<input type='text' id='"+this.options.textBoxID+"' class='property text_select' />").appendTo(b);this._tb.change(function(g){d._trigger("onChangeText",g,a(this).val())});this._tb.keydown(function(g){if(g.keyCode==13){d._trigger("onChangeText",g,a(this).val())}});this._setTool()},resetTextBox:function(){this._tb.val("")},_valueChangedBySlide:function(f,e,c,h){if(!this._onInit){var b=e.value;var g=e.value;switch(h){case"diameter":b=(b*2)+1;g=b+"px";break;case"hardness":b=b;g=b;break;case"tolerance":b=b;g=b+"%";break;case"fontSize":b=b;g=b+"px";break}a("#amount_"+h).html(g)}var d={id:h,value:b};this._trigger("onChange",f,d)},_setTool:function(){if(this._currentTool=="Eyedropper"){this.element.css("display","none")}else{this.element.css("display","");var b=this._visibilityArray[this._currentTool];for(var c=0;c<this._containers.length;c++){this._containers[c].css("display","none")}for(var c=0;c<b.length;c++){this._containers[b[c]].css("display","")}}},tool:function(b){if(arguments.length){this._currentTool=b;this._setTool()}return this._currentTool},_setOption:function(c,b){a.Widget.prototype._setOption.apply(this,arguments)},destroy:function(){}})}(jQuery));/* uploadBox.js*/
var uploadBox={create:function(b){var a=this;this._JcropObject;this._objResponse;this._jcropCoordinates;this._resArray={64:0,32:1,24:2,16:3};this._dimensions=[64,32,24,16];this._previewImages=["64x64","32x32","24x24","16x16"];$("#import_preview_64x64_I").click(function(){$("#checkbox64x64").attr("checked",!$("#checkbox64x64").attr("checked"))});$("#import_preview_32x32_I").click(function(){$("#checkbox32x32").attr("checked",!$("#checkbox32x32").attr("checked"))});$("#import_preview_24x24_I").click(function(){$("#checkbox24x24").attr("checked",!$("#checkbox24x24").attr("checked"))});$("#import_preview_16x16_I").click(function(){$("#checkbox16x16").attr("checked",!$("#checkbox16x16").attr("checked"))});$("#import_box").dialog({modal:true,width:720,height:400,resizable:false,draggable:false,autoOpen:false,closeText:""});$("#cancel_button").click(function(){a.close()});this._myUpload=$("#import_big_button").upload({name:"image",action:"FileUpload.ashx",enctype:"multipart/form-data",params:{action:"upload"},autoSubmit:true,onSelect:function(){$("#cropbox").remove();$(".icon_preview_img").remove();$("#upload_error").css("display","none")},onSubmit:function(){$("#upload_info").css("display","block")},onComplete:function(c){a._onUploadComplete(c)}})},_onUploadComplete:function(b){var a=this;$("#upload_info").css("display","none");this._objResponse=jQuery.parseJSON(b);if(this._objResponse==null){if(this._JcropObject){this._JcropObject.destroy()}return}if(this._objResponse.Error){$("#upload_error").html(this._objResponse.Error);$("#upload_error").css("display","block");return}$("#ok_button").unbind("click");if(this._objResponse.Type=="ico"){for(previewImage in this._previewImages){var e=this._previewImages[previewImage];var f=e.slice(0,2);var h=$("#import_preview_"+e+" .icon_container div");h.empty();var c=$("<canvas></canvas>");c.attr("class","icon_preview_img");c.attr("id","icon_preview_canvas"+f);c.attr("title","Preview "+e);c.attr("alt","Preview "+e);c.attr("width",f);c.attr("height",f);c.appendTo(h);this._copyToPreviewCanvas(c,this._objResponse["Img"+f])}$("#editor_import_image").html('<img src="image/preview_not_available.png" alt="Preview not available" title="Preview not available" /><div class="preview_message">Cropping not available with icons import</div>');$("#ok_button").click(function(){a._setImages()})}else{var d="ImageFromStorage.ashx?Name="+this._objResponse.FilePath;$("#editor_import_image").html($(document.createElement("img")).attr({src:d,id:"cropbox",title:"Image uploaded",alt:"Image uploaded",width:this._objResponse.Width,height:this._objResponse.Height}));for(previewImage in this._previewImages){var e=this._previewImages[previewImage];var h=$("#import_preview_"+e+" .icon_container div");h.empty();var g=$("<img></img>");g.attr("class","icon_preview_img");g.attr("src",d);g.attr("title","Preview "+e);g.attr("alt","Preview "+e);g.appendTo(h)}if(this._JcropObject){this._JcropObject.destroy()}this._JcropObject=$.Jcrop("#cropbox",{onChange:function(i){a._showPreview(i)},onSelect:function(i){a._showPreview(i)},aspectRatio:1,setSelect:[0,0,64,64],bgColor:"#DDD"});$("#ok_button").click(function(){a._processImages()})}$(".import_preview input:checkbox").each(function(i){$(this).attr("checked",!iconCanvas.getIsChanged(i))});$("#ok_button").removeClass("button_disabled")},_copyToPreviewCanvas:function(b,f){var c=b[0].getContext("2d");var d=c.getImageData(0,0,parseInt(b.attr("width"),10),parseInt(b.attr("height"),10));var g=d.data.length;var e=f.split(",");for(var a=0;a<g;a++){d.data[a]=parseInt(e[a],10)}c.putImageData(d,0,0)},open:function(){$("#import_box").dialog("open");$("#ok_button").addClass("button_disabled");$(".import_preview input").attr("checked",false);$("#upload_error").css("display","none")},close:function(){if(this._JcropObject){this._JcropObject.destroy()}$("#editor_import_image").html("");$("#import_box").dialog("close");$("#cropbox").remove();$("#ok_button").unbind("click");$(".icon_preview_img").remove()},_getFileName:function(a){return a.match(/[-_\w]+[.][\w]+$/i)[0]},_setImages:function(){var b=[];$(".import_preview input:checkbox").each(function(c){if($(this).is(":checked")){b.push($(this).val())}});if(b.length<1){$("#upload_error").html("Select at least one size to import or click the 'cancel' button");$("#upload_error").css("display","block");return}for(checkbox in b){var a=b[checkbox].slice(0,2);iconCanvas.setImageArray(this._resArray[a],this._objResponse["Img"+a])}this.close()},_showPreview:function(b){this._jcropCoordinates={width:b.w,height:b.h,x:b.x,y:b.y};for(dimension in this._dimensions){var a=this._dimensions[dimension]/b.w;var c=this._dimensions[dimension]/b.h;$("#import_preview_"+this._dimensions[dimension]+"x"+this._dimensions[dimension]+" .icon_container img").css({width:Math.round(a*this._objResponse.Width)+"px",height:Math.round(c*this._objResponse.Height)+"px",marginLeft:"-"+Math.round(a*b.x)+"px",marginTop:"-"+Math.round(c*b.y)+"px"})}},_processImages:function(){var c=this;var b=[];$(".import_preview input:checkbox").each(function(e){if($(this).is(":checked")){b.push($(this).val())}});if(b.length<1){$("#upload_error").html("Select at least one size to import or click the 'cancel' button");$("#upload_error").css("display","block");return}var a=this._getFileName(this._objResponse.FilePath);data="{";for(coord in this._jcropCoordinates){data+='"'+coord+'":'+this._jcropCoordinates[coord]+", "}data+='"fileName":"'+a+'"';var d="";for(checkbox in b){d+='"'+b[checkbox]+'",'}d=d.substring(0,d.length-1);data+=',"toExtract":['+d+"]";data+="}";this.close();$("#import_preview input").attr("checked",false);$("#waiting_box").dialog("open");$.ajax({type:"POST",url:"ImagesWebService.asmx/GetData",data:data,contentType:"application/json; charset=utf-8",dataType:"json",success:function(g){var f=jQuery.parseJSON(g.d);for(dimension in c._dimensions){var e=c._resArray[c._dimensions[dimension]];var h="Img"+c._dimensions[dimension];if(f[h].length>0){iconCanvas.setImageArray(e,f[h])}}$("#waiting_box").dialog("close")},error:function(e){$("#waiting_box").html(e)}})}};/* xicon editor main Code */
var _arrayResolution=["0","5","15","30","60","80"];var _arrayColor=[["#cccccc","#ffffff"],["#c3dce0","#edf8fa"],["#c5cfa1","#f7f9ee"],["#222222","#EEEEEE"],["#000000","#CCCCCC"]];var _enableQuestionOnExit=false;function getInternetExplorerVersion(){var a=-1;if(navigator.appName=="Microsoft Internet Explorer"){var c=navigator.userAgent;var b=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(b.exec(c)!=null){a=parseFloat(RegExp.$1)}}return a}function IsIE9(){var a=getInternetExplorerVersion();if(a>-1){if(a>=9){return true}else{return false}}return false}window.onbeforeunload=function(b){if(this._enableQuestionOnExit){var a="Leaving this page, all done work will be discarded.";var b=b||window.event;if(b){b.returnValue=a}else{return a}}};$(function(){var b=!!document.createElement("canvas").getContext;$("#init_message").css("display","none");if(b){$("#column_main").css("display","block")}else{$("#browser_message").css("display","block");return}$("#slider_settings_grid_resolution").slider({value:4,min:0,max:5,step:1,orientation:"vertical",slide:function(f,e){$("#amount_settings_grid_resolution").html(_arrayResolution[e.value]);iconCanvas.setGridSize(_arrayResolution[e.value])}});$(".tools a.tool").click(function(e){e.preventDefault();$(".tools a.tool").removeClass("current");$($(this)).addClass("current")});$("#amount_settings_grid_resolution").html(_arrayResolution[$("#slider_settings_grid_resolution").slider("value")]);brushSelector.create();$("#toolSettingsDiv").toolSettings({onChange:brushSettingsChange,onChangeFontFamily:function(e,f){iconCanvas.fontFamily(f)},onChangeText:function(e,f){iconCanvas.text(f)}});iconCanvas.create("canvasDiv64");$("#canvasDiv64").bind("onEyedropper",function(){eyeDropper()});$("#colorTool").colorSelector({onColorChange:changeColor});var c=$("#gridColors");for(var a=0;a<_arrayColor.length;a++){var d=$("<a class='combo' href='#'></a>").appendTo(c);d.attr("data-color",_arrayColor[a][1]);d.attr("data-alt",_arrayColor[a][0]);if(a==0){d.addClass("current")}$("<div class='settings_color_box settings_color_box_top'></div>").appendTo(d).css("background-color",_arrayColor[a][0]);$("<div class='settings_color_box settings_color_box_bottom'></div>").appendTo(d).css("background-color",_arrayColor[a][1]);d.click(function(e){e.preventDefault();$(".combo").removeClass("current");$(this).addClass("current");iconCanvas.setBackgroundColors($(this).attr("data-color"),$(this).attr("data-alt"))})}$(".tool").click(function(){changeTool($(this)[0].id)});$("#empty_box").dialog({modal:true,width:300,height:150,resizable:false,draggable:false,autoOpen:false,closeText:"close"});$("#waiting_box").dialog({modal:true,width:200,height:100,resizable:false,draggable:false,autoOpen:false,closeText:""});$("#preview_box").dialog({modal:true,width:300,height:180,resizable:false,draggable:false,autoOpen:false,closeText:"close",close:function(f,e){if(postGetIconData&&postGetIconData.readyState!=4){postGetIconData.abort()}}});$("#export_box").dialog({modal:true,width:670,height:380,resizable:false,draggable:false,autoOpen:false,closeText:"close",close:function(f,e){if(postGetIconData&&postGetIconData.readyState!=4){postGetIconData.abort()}}});uploadBox.create("import_box");$("#preview_link").click(function(){$("#preview_box").dialog("close")});$("#export_link").click(function(){$("#export_box").dialog("close")});if(IsIE9()){if(window.external.msIsSiteMode()){_gaq.push(["_trackEvent","IE","Open","SiteMode"])}else{_gaq.push(["_trackEvent","IE","Open","NO_SiteMode"])}}});function getIconData(d){var b=true;var g=iconCanvas.getImageArray(0);if(g!=""){b=false}var f=iconCanvas.getImageArray(1);if(f!=""){b=false}var a=iconCanvas.getImageArray(2);if(a!=""){b=false}var c=iconCanvas.getImageArray(3);if(c!=""){b=false}var e="{'data64':'"+g+"','data32':'"+f+"','data24':'"+a+"','data16':'"+c+"','action':'"+d+"'}";return{data:e,isEmpty:b}}function previewIcons(b){b.preventDefault();var a=getIconData("preview");if(a.isEmpty){$("#empty_box").dialog("open");return}$("#preview_head").css("display","none");$("#preview_wait_box").css("display","");$("#preview_box").dialog("open");var a=getIconData("preview");postGetIconData=$.ajax({type:"POST",url:"ImagesWebService.asmx/GenerateIcon",data:a.data,contentType:"application/json; charset=utf-8",dataType:"json",success:function(c){previewSucceeded(c)},error:function(c){previewFailed(c)}})}function exportIcons(b){b.preventDefault();var a=getIconData("export");if(a.isEmpty){$("#empty_box").dialog("open");return}$("#export_head").css("display","none");$("#export_wait_box").css("display","");$("#export_box").dialog("open");$("#originalSize").html("<em>Data not available yet</em>");$("#newSize").html("<em>Data not available yet</em>");postGetIconData=$.ajax({type:"POST",url:"ImagesWebService.asmx/GenerateIcon",data:a.data,contentType:"application/json; charset=utf-8",dataType:"json",success:function(c){exportSucceeded(c)},error:function(c){exportFailed(c)}})}function previewFailed(a){}function previewSucceeded(a){$("#preview_head").css("display","");$("#preview_wait_box").css("display","none");var b=jQuery.parseJSON(a.d);$("#preview_link").attr("href","PreviewIcon.aspx?R="+b.StoreFileID)}function exportFailed(a){}function exportSucceeded(a){$("#export_head").css("display","");$("#export_wait_box").css("display","none");var b=jQuery.parseJSON(a.d);$("#export_link").attr("href","GetIcon.ashx?R="+b.StoreFileID);$("#originalSize").html(b.OriginalSize);$("#newSize").html(b.NewSize)}function changeColor(){var a=$("#colorTool").colorSelector("color");iconCanvas.color(a);brushSelector.color(a)}function changeTool(a){iconCanvas.tool(a);$("#toolSettingsDiv").toolSettings("tool",a);if(a=="Brush"||a=="Pencil"){brushSelector.tool(a)}}function eyeDropper(){var a=iconCanvas.color();$("#colorTool").colorSelector("color",a)}function redo(a){a.preventDefault();iconCanvas.redo()}function clearData(a){a.preventDefault();iconCanvas.clear()}function undo(a){a.preventDefault();iconCanvas.undo()}function brushSettingsChange(b,a){switch(a.id){case"diameter":iconCanvas.brushSize(a.value);brushSelector.brushSize(a.value);break;case"hardness":brushSelector.hardness(a.value);break;case"tolerance":iconCanvas.tolerance(a.value);break;case"fontSize":iconCanvas.fontSize(a.value);break}}function openImport(a){a.preventDefault();uploadBox.open()};